<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High School Major Exploration | CloverPath</title>
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to bottom, #ffffff, #f8fafc);
            min-height: 100vh;
            color: #0f172a;
        }

        /* Container */
        .hs-container {
            max-width: 672px;
            margin: 0 auto;
            padding: 1rem;
        }

        @media (min-width: 768px) {
            .hs-container {
                padding: 1rem;
            }
        }

        /* Header */
        .hs-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .hs-header-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: #475569;
        }

        .hs-restart-btn {
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            color: #334155;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .hs-restart-btn:hover {
            background-color: #f8fafc;
        }

        /* Card */
        .hs-card {
            background: white;
            border-radius: 1rem;
            border: 1px solid #e2e8f0;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        /* Title Section */
        .hs-title {
            margin-bottom: 1rem;
        }

        .hs-title h1 {
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.025em;
        }

        .hs-title p {
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: #475569;
        }

        /* Progress Bar */
        .hs-progress-wrapper {
            margin-bottom: 1rem;
        }

        .hs-progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #475569;
            margin-bottom: 0.5rem;
        }

        .hs-progress-bar {
            width: 100%;
            height: 0.5rem;
            background-color: #e2e8f0;
            border-radius: 0.25rem;
            overflow: hidden;
        }

        .hs-progress-fill {
            height: 100%;
            background-color: #008208;
            transition: width 0.3s ease;
        }

        /* Pill Badge */
        .hs-pill {
            display: inline-flex;
            align-items: center;
            background-color: #f1f5f9;
            border-radius: 9999px;
            padding: 0.25rem 0.625rem;
            font-size: 0.75rem;
            color: #334155;
        }

        /* Prompt Box */
        .hs-prompt {
            background-color: #f8fafc;
            border-radius: 0.75rem;
            padding: 0.75rem;
            font-size: 0.875rem;
            color: #1e293b;
            margin: 0.5rem 0;
        }

        /* Buttons */
        .hs-btn {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .hs-btn-primary {
            background-color: #0f172a;
            color: white;
        }

        .hs-btn-primary:hover:not(:disabled) {
            background-color: #1e293b;
        }

        .hs-btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .hs-btn-secondary {
            background-color: white;
            color: #0f172a;
            border: 1px solid #e2e8f0;
        }

        .hs-btn-secondary:hover {
            background-color: #f8fafc;
        }

        .hs-btn-ghost {
            background-color: transparent;
            color: #0f172a;
        }

        .hs-btn-ghost:hover {
            background-color: #f8fafc;
        }

        /* Option Buttons */
        .hs-options {
            display: grid;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .hs-option-btn {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            text-align: left;
            cursor: pointer;
            border: 1px solid #e2e8f0;
            background-color: white;
            color: #1e293b;
            transition: all 0.2s;
        }

        .hs-option-btn:hover {
            background-color: #f8fafc;
        }

        .hs-option-btn.selected {
            background-color: #0f172a;
            color: white;
            border-color: #0f172a;
        }

        /* Checkbox Options */
        .hs-checkbox-option {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            background-color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .hs-checkbox-option:hover {
            background-color: #f8fafc;
        }

        .hs-checkbox {
            width: 1rem;
            height: 1rem;
            margin-top: 0.125rem;
            flex-shrink: 0;
            cursor: pointer;
        }

        .hs-checkbox-label {
            font-size: 0.875rem;
            line-height: 1.25rem;
        }

        /* Radio Group */
        .hs-radio-group {
            display: grid;
            gap: 0.75rem;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 0.75rem;
        }

        .hs-radio-option {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .hs-radio {
            width: 1rem;
            height: 1rem;
            margin-top: 0.25rem;
            flex-shrink: 0;
            cursor: pointer;
        }

        .hs-radio-label {
            font-size: 0.875rem;
            line-height: 1.25rem;
            cursor: pointer;
        }

        /* Button Container */
        .hs-btn-container {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .hs-btn-half {
            width: 50%;
        }

        /* Helper Text */
        .hs-helper-text {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.75rem;
        }

        /* Separator */
        .hs-separator {
            height: 1px;
            background-color: #e2e8f0;
            margin: 1rem 0;
        }

        /* Badge */
        .hs-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .hs-badge-default {
            background-color: #0f172a;
            color: white;
        }

        .hs-badge-secondary {
            background-color: #f1f5f9;
            color: #334155;
        }

        /* Cluster Card */
        .hs-cluster-card {
            border-radius: 1rem;
            border: 1px solid #e2e8f0;
            background-color: white;
            padding: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .hs-cluster-card:hover {
            background-color: #f8fafc;
        }

        .hs-cluster-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .hs-cluster-desc {
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: #334155;
            line-height: 1.25rem;
        }

        .hs-cluster-hint {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: #64748b;
        }

        /* List Styles */
        .hs-list {
            margin-top: 0.5rem;
            padding-left: 1.25rem;
            list-style-type: disc;
        }

        .hs-list li {
            font-size: 0.875rem;
            color: #334155;
            line-height: 1.5rem;
        }

        /* Section Header */
        .hs-section-header {
            font-size: 0.875rem;
            font-weight: 600;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .hs-section-header:first-child {
            margin-top: 0;
        }

        .hs-section-subheader {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        /* Hidden Utility */
        .hidden {
            display: none !important;
        }

        /* Details/Summary */
        details {
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            background-color: white;
            padding: 0.75rem;
        }

        summary {
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* School Item */
        .hs-school-item {
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            background-color: white;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .hs-school-name {
            font-size: 0.875rem;
            font-weight: 600;
        }

        .hs-school-note {
            font-size: 0.75rem;
            color: #475569;
        }

        /* Region Buttons */
        .hs-region-btn {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            cursor: pointer;
            border: 1px solid #e2e8f0;
            background-color: white;
            transition: all 0.2s;
        }

        .hs-region-btn:hover {
            background-color: #f8fafc;
        }

        /* Loading State */
        .hs-loading {
            text-align: center;
            padding: 2rem;
            color: #64748b;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="hs-container">
        <div class="hs-header">
            <div class="hs-header-title">HS Major Exploration · CloverPath</div>
            <button class="hs-restart-btn hidden" onclick="restartAssessment()">Restart</button>
        </div>

        <div id="app-content">
            <!-- Content will be dynamically inserted here -->
        </div>
    </div>

    <script>
        // ========================================
        // DATA STRUCTURES
        // ========================================

        const state = {
            screen: 'welcome',
            pass1: {
                index: 0,
                answers: {}
            },
            selectedDomains: new Set(),
            pass2: {
                order: [],
                index: 0,
                answers: {}
            },
            surfacedClusters: [],
            lastClusterId: null,
            activeCluster: null,
            activeMajor: null,
            comparePair: null,
            schoolsData: {
                region: null,
                loading: false,
                schools: []
            }
        };

        const PASS1_SCALE = [
            { value: 3, label: "Sounds a lot like me" },
            { value: 2, label: "Sounds somewhat like me" },
            { value: 1, label: "Not really me" },
            { value: 0, label: "Doesn't sound like me at all" }
        ];

        const domains = [
            { id: "build_make", title: "Building & Making Things", prompt: "I like building things, putting stuff together, or making something that actually works." },
            { id: "fix_hands", title: "Fixing, Crafting & Working with Your Hands", prompt: "I enjoy working with my hands — fixing things, crafting, cooking, or learning practical skills." },
            { id: "analyze_solve", title: "Analyzing & Solving Problems", prompt: "I like figuring things out, solving problems, or breaking something down to understand how it works." },
            { id: "create_express", title: "Creating & Expressing Ideas", prompt: "I enjoy expressing ideas through writing, art, music, video, or creative projects." },
            { id: "perform_entertain", title: "Performing & Entertaining", prompt: "I like performing, being on stage, entertaining people, or expressing myself live." },
            { id: "help_support", title: "Helping & Supporting People", prompt: "I enjoy helping others, supporting people, or making a positive difference in someone's life." },
            { id: "teach_coach", title: "Teaching, Coaching & Explaining", prompt: "I like explaining things, helping others learn, or coaching people to improve." },
            { id: "lead_sell", title: "Leading, Influencing & Making Things Happen", prompt: "I enjoy getting people on board with an idea, organizing groups, or helping a plan actually move forward." },
            { id: "organize_track", title: "Organizing & Keeping Things on Track", prompt: "I like organizing details, following steps, and making sure things run smoothly." },
            { id: "compete_train", title: "Competing, Training & Pushing Yourself", prompt: "I enjoy competition, training, pushing myself physically, or performing under pressure." },
            { id: "outdoors_animals", title: "Exploring the Outdoors & Working with Animals", prompt: "I like being outdoors, working with animals, or learning about nature and the environment." },
            { id: "explore_research", title: "Exploring, Researching & Discovering", prompt: "I'm curious and like exploring new ideas, asking big questions, or learning how the world works." },
            { id: "design_better", title: "Designing Experiences & Making Things Better", prompt: "I like noticing how things feel for people — like spaces, apps, or products — and thinking about how to make them better." }
        ];

        const clusters = [
            {
                id: "eng_tech",
                title: "Engineering & Technology",
                about: "Designing, building, and improving how things work — from machines and structures to technology.",
                enjoy: "Solving practical problems, testing solutions, improving designs over time.",
                majors: ["Mechanical Engineering", "Electrical Engineering", "Civil Engineering", "Engineering Technology", "Industrial Engineering"],
                workOn: ["Designing something on paper or on a computer before it's built", "Building prototypes or models and improving them", "Testing different fixes to see what works", "Using math or science ideas to choose between options"],
                learningFeels: ["A mix of problem-solving, projects, and some theory", "Planning before building", "Trying, learning from mistakes, and trying again"],
                cipCodes: ["14"]
            },
            {
                id: "cs_data",
                title: "Computer, Data & Information Fields",
                about: "Working with computers, data, and digital information to solve problems or build tools people use.",
                enjoy: "Logical thinking, coding, finding patterns, building digital solutions.",
                majors: ["Computer Science", "Information Systems", "Data Science", "Cybersecurity", "Information Technology"],
                workOn: ["Building simple apps, games, or websites", "Using data to answer questions", "Debugging: figuring out why something isn't working", "Designing tools that make tasks easier"],
                learningFeels: ["Lots of practice and projects", "Step-by-step problem solving", "Testing ideas quickly and improving"],
                cipCodes: ["11"]
            },
            {
                id: "sci",
                title: "Physical & Life Sciences",
                about: "Understanding how the natural world works — including physics, chemistry, biology, and related sciences.",
                enjoy: "Asking 'why' questions, experimenting, analyzing results, discovery.",
                majors: ["Biology", "Chemistry", "Physics", "Biochemistry", "Neuroscience"],
                workOn: ["Running experiments or labs", "Collecting and analyzing data", "Investigating questions about the natural world", "Learning how living or physical systems behave"],
                learningFeels: ["Lab work and research projects", "Careful observation and analysis", "Open-ended questions that take time"],
                cipCodes: ["26", "40", "41"]
            },
            {
                id: "biz",
                title: "Business, Economics & Entrepreneurship",
                about: "How organizations and markets work — and how ideas turn into products, services, or businesses.",
                enjoy: "Decision-making, leadership, persuasion, understanding how value is created.",
                majors: ["Business Administration", "Economics", "Finance", "Marketing", "Management", "Entrepreneurship"],
                workOn: ["Planning projects or running group activities", "Making decisions about resources and tradeoffs", "Pitching ideas or convincing others", "Solving problems that affect customers or teams"],
                learningFeels: ["Group projects and real-world examples", "Discussing choices and explaining why", "Balancing people, money, and time constraints"],
                cipCodes: ["52"]
            },
            {
                id: "social",
                title: "Social Sciences",
                about: "Understanding people, groups, and societies — how they think, behave, and interact.",
                enjoy: "Learning about behavior and culture, analyzing how societies change.",
                majors: ["Psychology", "Sociology", "Anthropology", "Political Science", "Human Geography"],
                workOn: ["Asking questions about people and behavior", "Reading and discussing different viewpoints", "Using surveys, interviews, or studies to learn", "Connecting patterns to real-world issues"],
                learningFeels: ["Discussion-heavy learning", "Writing and explaining your thinking", "Often more than one reasonable answer"],
                cipCodes: ["42", "45"]
            },
            {
                id: "comm",
                title: "Communication, Media & Design",
                about: "Sharing ideas and information through writing, visuals, media, and design.",
                enjoy: "Storytelling, communication, design, understanding how messages affect people.",
                majors: ["Communication Studies", "Graphic Design", "Digital Media", "Journalism", "Advertising", "Public Relations"],
                workOn: ["Creating videos, graphics, or content", "Designing posters, websites, or social media", "Writing stories or messages", "Thinking about what will connect with an audience"],
                learningFeels: ["Creative projects and presentations", "Feedback and revision", "Balancing creativity with clarity"],
                cipCodes: ["09", "10", "50"]
            },
            {
                id: "arts",
                title: "Arts & Performing Arts",
                about: "Expressing ideas and emotions through performance or artistic creation.",
                enjoy: "Performing, rehearsing, creating art or music, sharing work with others.",
                majors: ["Visual Arts", "Music", "Theater", "Dance", "Film Production", "Creative Writing"],
                workOn: ["Practicing or rehearsing performances", "Creating art, music, writing, or film", "Building a portfolio of work", "Collaborating on productions or shows"],
                learningFeels: ["A lot of practice and feedback", "Creative risk-taking", "Comfort being seen and evaluated"],
                cipCodes: ["50"]
            },
            {
                id: "health",
                title: "Health & Human Services",
                about: "Supporting people's health, well-being, and quality of life.",
                enjoy: "Helping others directly, making a meaningful difference, structured environments.",
                majors: ["Nursing", "Public Health", "Health Sciences", "Social Work", "Human Services", "Kinesiology"],
                workOn: ["Supporting people through challenges", "Learning about health and well-being", "Working in structured settings with responsibility", "Team-based problem solving around people's needs"],
                learningFeels: ["People-centered learning", "Clear standards and responsibilities", "Practice-based learning (simulations, placements)"],
                cipCodes: ["51", "44"]
            },
            {
                id: "edu",
                title: "Education & Learning Sciences",
                about: "Helping people learn, grow, and improve through teaching, coaching, or training.",
                enjoy: "Explaining ideas, mentoring others, planning lessons, supporting learning.",
                majors: ["Education", "Elementary Education", "Secondary Education", "Special Education", "Educational Psychology"],
                workOn: ["Explaining concepts in different ways", "Coaching others to improve", "Planning activities that help learning", "Working with different learning styles"],
                learningFeels: ["Communication-heavy", "Practice + reflection", "Patience and relationship-building"],
                cipCodes: ["13"]
            },
            {
                id: "env",
                title: "Environmental & Earth Sciences",
                about: "Studying the Earth, the environment, and how people interact with natural systems.",
                enjoy: "Nature, sustainability, fieldwork, environmental challenges.",
                majors: ["Environmental Studies", "Environmental Science", "Earth Science", "Geology", "Sustainability Studies"],
                workOn: ["Learning about ecosystems and environmental change", "Collecting information outdoors or in labs", "Exploring sustainability solutions", "Understanding how humans impact nature"],
                learningFeels: ["A mix of science and real-world issues", "Sometimes fieldwork or outdoor learning", "Big-picture thinking about impacts"],
                cipCodes: ["03", "40"]
            },
            {
                id: "civic",
                title: "Public Policy, Law & Civic Fields",
                about: "How rules, laws, and public decisions are made — and how they affect communities.",
                enjoy: "Debating issues, fairness, writing and discussion, community problem-solving.",
                majors: ["Political Science", "Public Policy", "Legal Studies", "Criminal Justice", "International Relations", "Public Administration"],
                workOn: ["Discussing and debating real issues", "Understanding rules and how they work", "Writing persuasive arguments", "Thinking about fairness and impact"],
                learningFeels: ["Reading and writing a lot", "Discussion and viewpoints", "Often more than one reasonable answer"],
                cipCodes: ["22", "43", "44", "45"]
            },
            {
                id: "skilled",
                title: "Skilled & Applied Technical Fields",
                about: "Hands-on, applied learning focused on building, fixing, or maintaining real-world systems and equipment.",
                enjoy: "Working with tools, learning by doing, seeing results quickly.",
                majors: ["Automotive Technology", "Construction Management", "Electrical / Mechanical Technology", "Welding / Manufacturing Technology", "HVAC Technology", "Culinary Arts"],
                workOn: ["Fixing or installing real equipment", "Working with tools and machines", "Building or repairing things directly", "Solving practical problems with immediate impact"],
                learningFeels: ["Hands-on classes (labs/shops)", "Learning by doing", "Practicing skills to improve"],
                cipCodes: ["46", "47", "48", "49", "12", "15"]
            }
        ];

        const domainBaseClusters = {
            build_make: ["eng_tech", "skilled"],
            fix_hands: ["skilled"],
            analyze_solve: ["eng_tech", "cs_data", "sci", "biz"],
            create_express: ["comm", "arts"],
            perform_entertain: ["arts"],
            help_support: ["health", "social"],
            teach_coach: ["edu", "health"],
            lead_sell: ["biz", "comm", "civic"],
            organize_track: ["biz", "skilled", "civic"],
            compete_train: ["health", "edu", "biz"],
            outdoors_animals: ["env", "sci"],
            explore_research: ["sci", "social", "env"],
            design_better: ["comm", "eng_tech", "cs_data"]
        };

        // FULL PASS 2 MODULES (All 13)
        const pass2Modules = {
            design_better: {
                intro: "This area is about noticing how things feel for people — like spaces, apps, events, or products — and thinking about how to improve them.",
                activities: [
                    "Noticing when an app, website, or game feels confusing to use",
                    "Rearranging a space to make it feel better or work better",
                    "Planning events so people have a good experience",
                    "Improving something that works but feels awkward",
                    "Getting annoyed when things are poorly designed"
                ],
                envStyle: {
                    q: "If you were doing something like this, which setting sounds more appealing?",
                    options: [
                        { key: "team", label: "Working on a team, bouncing ideas around, improving things together" },
                        { key: "solo", label: "Working on your own first, then sharing once ideas are formed" },
                        { key: "mix", label: "A mix of both" }
                    ]
                },
                motivations: [
                    "Seeing people enjoy using something you improved",
                    "Making something feel simpler or easier to use",
                    "Solving a problem that was bothering people",
                    "Having creative freedom",
                    "Knowing your change actually helped someone",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Explaining your ideas to others",
                    "Getting feedback and making changes",
                    "Not having one right answer",
                    "Paying attention to small details",
                    "Working within limits (time, rules, budgets)",
                    "None of these bother me much"
                ]
            },
            compete_train: {
                intro: "This area is about challenging yourself, training to improve, and performing under pressure. You don't need to be a varsity athlete — just explore what parts feel like you.",
                activities: [
                    "Training regularly to get better at something",
                    "Competing against others or yourself",
                    "Performing well under pressure (games, events)",
                    "Pushing through discomfort to improve",
                    "Being part of a team working toward a goal",
                    "Tracking progress over time"
                ],
                envStyle: {
                    q: "Which situation feels more appealing?",
                    options: [
                        { key: "clear", label: "Clear goals, rules, and feedback (you know how you're doing)" },
                        { key: "open", label: "Open-ended challenges where outcomes aren't always clear" },
                        { key: "mix", label: "A mix of both" }
                    ]
                },
                motivations: [
                    "Trying to beat a personal best",
                    "Winning or performing better than others",
                    "Being part of a team",
                    "The structure and routine of training",
                    "Feeling strong, capable, or disciplined",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Strict schedules or routines",
                    "Repetitive training",
                    "Physical discomfort or fatigue",
                    "Losing or not performing well",
                    "Pressure to perform in front of others",
                    "None of these really bother me"
                ]
            },
            analyze_solve: {
                intro: "This area is about figuring things out — noticing patterns, solving puzzles, and breaking problems into parts. You don't need to be a 'math person' to explore it.",
                activities: [
                    "Solving puzzles, logic problems, or brain teasers",
                    "Figuring out why something isn't working",
                    "Looking for patterns in numbers or information",
                    "Breaking a big problem into smaller steps",
                    "Comparing options to decide what makes sense",
                    "Enjoying questions with clear answers"
                ],
                envStyle: {
                    q: "Which kind of problem sounds more appealing?",
                    options: [
                        { key: "rules", label: "Problems with clear rules and right answers" },
                        { key: "messy", label: "Messy problems with lots of unknowns" },
                        { key: "mix", label: "A mix of both" }
                    ]
                },
                motivations: [
                    "Reaching a clear solution",
                    "Knowing your answer is correct",
                    "Understanding how something works",
                    "Making decisions based on logic",
                    "Finding the most efficient way to do something",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Problems with no clear solution",
                    "Explaining your thinking to others",
                    "Working with incomplete or messy information",
                    "Spending a long time on one problem",
                    "Having your solution questioned",
                    "None of these really bother me"
                ]
            },
            build_make: {
                intro: "This area is about making things — building, putting parts together, and enjoying the satisfaction of something working.",
                activities: [
                    "Building a project and seeing it work",
                    "Following steps to assemble something",
                    "Improving a design after testing it",
                    "Using tools (digital or physical) to make something real",
                    "Fixing small issues until it works better"
                ],
                envStyle: {
                    q: "Which sounds more fun?",
                    options: [
                        { key: "hands", label: "Hands-on building and testing" },
                        { key: "plan", label: "Planning first, then building" },
                        { key: "mix", label: "A mix of both" }
                    ]
                },
                motivations: [
                    "Seeing a finished result",
                    "Making something useful",
                    "Solving a practical challenge",
                    "Working with tools or tech",
                    "Learning by doing",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Things breaking and needing fixes",
                    "Details and measurements",
                    "Long projects",
                    "Working with rules or safety steps",
                    "Not having the right materials",
                    "None of these bother me"
                ]
            },
            fix_hands: {
                intro: "This area is about hands-on skills — fixing, crafting, cooking, and learning practical ways to make things work.",
                activities: [
                    "Fixing something that's broken",
                    "Learning how tools or machines work",
                    "Practicing a skill to get better",
                    "Following steps to get a clean result",
                    "Making something with your hands (food, crafts, repairs)"
                ],
                envStyle: {
                    q: "Which setting sounds better?",
                    options: [
                        { key: "shop", label: "Learning in a lab/shop/kitchen with hands-on practice" },
                        { key: "class", label: "Learning mostly in a classroom with notes and tests" },
                        { key: "mix", label: "A mix" }
                    ]
                },
                motivations: [
                    "Seeing results quickly",
                    "Feeling skilled and capable",
                    "Helping others by fixing real problems",
                    "Working with tools or materials",
                    "Making something that works",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Repetitive practice",
                    "Messy work or cleanup",
                    "Strict safety rules",
                    "Very detailed steps",
                    "Working slowly for precision",
                    "None of these bother me"
                ]
            },
            create_express: {
                intro: "This area is about expressing ideas — through art, writing, music, video, or creative projects.",
                activities: [
                    "Making art, writing, music, or videos",
                    "Coming up with original ideas",
                    "Telling stories or sharing a point of view",
                    "Designing something that looks and feels right",
                    "Experimenting with style or aesthetics"
                ],
                envStyle: {
                    q: "Which feels more like you?",
                    options: [
                        { key: "freedom", label: "Lots of creative freedom and personal style" },
                        { key: "brief", label: "A clear brief or prompt to design around" },
                        { key: "mix", label: "A mix" }
                    ]
                },
                motivations: [
                    "Expressing yourself",
                    "Making something beautiful or meaningful",
                    "Getting a reaction from an audience",
                    "Telling a story",
                    "Trying new styles",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Creative blocks",
                    "Feedback that changes your vision",
                    "Deadlines",
                    "Not knowing if it's good",
                    "Having to present your work",
                    "None of these bother me"
                ]
            },
            perform_entertain: {
                intro: "This area is about performing — being on stage, entertaining, and expressing yourself live.",
                activities: [
                    "Performing music, acting, dance, or speaking",
                    "Rehearsing to improve",
                    "Being part of a cast or ensemble",
                    "Expressing emotion through performance",
                    "Feeding off an audience's energy"
                ],
                envStyle: {
                    q: "Which environment sounds better?",
                    options: [
                        { key: "spotlight", label: "Being featured (more spotlight)" },
                        { key: "group", label: "Being part of a group performance" },
                        { key: "mix", label: "A mix" }
                    ]
                },
                motivations: [
                    "Being on stage",
                    "Entertaining people",
                    "Improving through practice",
                    "Working with a group",
                    "Expressing yourself",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Stage nerves",
                    "Rehearsals and repetition",
                    "Critiques",
                    "Auditions",
                    "Performing when you don't feel ready",
                    "None of these bother me"
                ]
            },
            help_support: {
                intro: "This area is about helping people — supporting others and making a positive difference.",
                activities: [
                    "Listening and supporting someone",
                    "Helping someone solve a problem",
                    "Volunteering or serving your community",
                    "Being the person others rely on",
                    "Working in teams where people matter"
                ],
                envStyle: {
                    q: "Which feels better?",
                    options: [
                        { key: "direct", label: "Helping people directly, one-on-one" },
                        { key: "behind", label: "Helping behind the scenes (planning, organizing support)" },
                        { key: "mix", label: "A mix" }
                    ]
                },
                motivations: [
                    "Making a difference",
                    "Being needed and helpful",
                    "Working with people",
                    "Solving real problems",
                    "Feeling connected to a mission",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Emotionally heavy situations",
                    "People not taking advice",
                    "Slow progress",
                    "Conflict",
                    "Lots of rules or paperwork",
                    "None of these bother me"
                ]
            },
            teach_coach: {
                intro: "This area is about helping others learn — explaining, coaching, mentoring, and helping people improve.",
                activities: [
                    "Explaining a concept in a simple way",
                    "Helping someone practice and improve",
                    "Planning learning activities",
                    "Being patient with questions",
                    "Giving feedback that helps"
                ],
                envStyle: {
                    q: "Which feels better?",
                    options: [
                        { key: "kids", label: "Working with kids/teens" },
                        { key: "peers", label: "Working with peers/adults" },
                        { key: "mix", label: "A mix" }
                    ]
                },
                motivations: [
                    "Seeing someone improve",
                    "Explaining things clearly",
                    "Leading a group",
                    "Building confidence in others",
                    "Helping people reach goals",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Repeating yourself",
                    "People not trying",
                    "Managing attention or behavior",
                    "Planning lessons",
                    "Being responsible for others",
                    "None of these bother me"
                ]
            },
            lead_sell: {
                intro: "This area is about helping ideas turn into action — getting people on board, organizing efforts, and moving things forward.",
                activities: [
                    "Leading a group project or club activity",
                    "Getting people excited about an idea or plan",
                    "Organizing an event, fundraiser, or team effort",
                    "Speaking up to influence a decision",
                    "Taking initiative when something needs to happen"
                ],
                envStyle: {
                    q: "Which role sounds more like you?",
                    options: [
                        { key: "front", label: "Being out front (presenting ideas, motivating people)" },
                        { key: "ops", label: "Organizing behind the scenes (planning, coordinating)" },
                        { key: "mix", label: "A mix of both" }
                    ]
                },
                motivations: [
                    "Seeing an idea actually happen",
                    "Bringing people together",
                    "Taking responsibility for outcomes",
                    "Solving problems quickly",
                    "Building something new",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "People not following through",
                    "Disagreements or pushback",
                    "Having to speak up a lot",
                    "Slow decision-making",
                    "Messy group dynamics",
                    "None of these bother me"
                ]
            },
            organize_track: {
                intro: "This area is about keeping things running smoothly — organizing details, following steps, and making sure nothing falls through the cracks.",
                activities: [
                    "Making checklists and plans",
                    "Keeping a group organized",
                    "Following a process to get a clean result",
                    "Noticing small mistakes and fixing them",
                    "Keeping schedules and deadlines on track"
                ],
                envStyle: {
                    q: "Which feels better?",
                    options: [
                        { key: "clear", label: "Clear steps and expectations" },
                        { key: "flex", label: "Flexible plans and changing tasks" },
                        { key: "mix", label: "A mix" }
                    ]
                },
                motivations: [
                    "Feeling organized",
                    "Making things run smoothly",
                    "Helping a team succeed",
                    "Clear rules and steps",
                    "Being reliable",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Disorganization",
                    "Last-minute changes",
                    "Unclear instructions",
                    "People being late or unprepared",
                    "Too much chaos",
                    "None of these bother me"
                ]
            },
            outdoors_animals: {
                intro: "This area is about the outdoors, animals, and the environment — being in nature and learning how it works.",
                activities: [
                    "Spending time outdoors",
                    "Working with animals",
                    "Learning about ecosystems and nature",
                    "Helping protect the environment",
                    "Doing hands-on outdoor projects"
                ],
                envStyle: {
                    q: "Which sounds better?",
                    options: [
                        { key: "field", label: "Being outside / fieldwork" },
                        { key: "lab", label: "Indoor labs / research" },
                        { key: "mix", label: "A mix" }
                    ]
                },
                motivations: [
                    "Being outside",
                    "Helping animals or nature",
                    "Learning how nature works",
                    "Solving environmental problems",
                    "Hands-on projects",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "Bad weather",
                    "Long outdoor days",
                    "Messy work",
                    "Lots of rules or permits",
                    "Not seeing results quickly",
                    "None of these bother me"
                ]
            },
            explore_research: {
                intro: "This area is about curiosity — exploring new ideas, asking big questions, and learning how the world works.",
                activities: [
                    "Researching a topic you're curious about",
                    "Asking why questions",
                    "Reading and learning about new ideas",
                    "Doing experiments or investigations",
                    "Exploring big questions with no easy answer"
                ],
                envStyle: {
                    q: "Which feels better?",
                    options: [
                        { key: "deep", label: "Going deep on one topic" },
                        { key: "wide", label: "Exploring lots of topics" },
                        { key: "mix", label: "A mix" }
                    ]
                },
                motivations: [
                    "Discovery",
                    "Understanding how things work",
                    "Asking big questions",
                    "Learning for its own sake",
                    "Finding evidence",
                    "I'm not sure yet"
                ],
                frustrations: [
                    "No clear answers",
                    "Slow progress",
                    "Lots of reading",
                    "Too many details",
                    "Having to prove everything",
                    "None of these bother me"
                ]
            }
        };

        // ========================================
        // COLLEGE SCORECARD API
        // ========================================

        const COLLEGE_SCORECARD_API = 'https://api.data.gov/ed/collegescorecard/v1/schools';
        const REGIONS = {
            'West': 8,
            'Midwest': 5,
            'Northeast': 1,
            'South': 5
        };

        async function fetchSchoolsByMajor(majorName, clusterId, region) {
            state.schoolsData.loading = true;
            state.schoolsData.schools = [];
            render();

            try {
                const cluster = clusters.find(c => c.id === clusterId);
                if (!cluster || !cluster.cipCodes) {
                    throw new Error('Cluster not found');
                }

                const cipCode = cluster.cipCodes[0];
                const params = new URLSearchParams({
                    'school.degrees_awarded.predominant': '3',
                    'school.operating': '1',
                    'latest.programs.cip_2_digit.code': cipCode,
                    '_fields': 'school.name,school.city,school.state,school.school_url,latest.student.size,latest.admissions.admission_rate.overall',
                    '_per_page': '10',
                    '_sort': 'latest.student.size:desc'
                });

                if (REGIONS[region]) {
                    params.append('school.region_id', REGIONS[region]);
                }

                const response = await fetch(`${COLLEGE_SCORECARD_API}?${params}`);
                if (!response.ok) throw new Error('API request failed');

                const data = await response.json();
                const schools = data.results
                    .filter(school => school['school.name'])
                    .slice(0, 8)
                    .map(school => {
                        let note = '';
                        const size = school['latest.student.size'];
                        const admissionRate = school['latest.admissions.admission_rate.overall'];
                        
                        if (size && size > 20000) {
                            note = 'Large public university';
                        } else if (size && size > 10000) {
                            note = 'Medium-sized university';
                        } else if (size && size > 2000) {
                            note = 'Smaller university';
                        } else {
                            note = 'Small college';
                        }
                        
                        if (admissionRate && admissionRate < 0.3) {
                            note += ', selective admissions';
                        } else if (admissionRate && admissionRate < 0.6) {
                            note += ', moderately selective';
                        }

                        return {
                            name: school['school.name'],
                            location: `${school['school.city']}, ${school['school.state']}`,
                            note: note,
                            url: school['school.school_url']
                        };
                    });

                state.schoolsData.schools = schools;
                state.schoolsData.loading = false;
                render();
                
            } catch (error) {
                console.error('Error fetching schools:', error);
                state.schoolsData.loading = false;
                state.schoolsData.schools = [{
                    name: 'Unable to load schools',
                    note: 'Please try again or select a different region'
                }];
                render();
            }
        }

        // ========================================
        // RENDERING FUNCTIONS
        // ========================================

        function render() {
            const content = document.getElementById('app-content');
            const restartBtn = document.querySelector('.hs-restart-btn');
            
            if (state.screen === 'welcome') {
                restartBtn.classList.add('hidden');
            } else {
                restartBtn.classList.remove('hidden');
            }

            switch (state.screen) {
                case 'welcome':
                    content.innerHTML = renderWelcome();
                    break;
                case 'pass1':
                    content.innerHTML = renderPass1();
                    break;
                case 'pass1_results':
                    content.innerHTML = renderPass1Results();
                    break;
                case 'pass2':
                    content.innerHTML = renderPass2();
                    break;
                case 'clusters':
                    content.innerHTML = renderClusters();
                    break;
                case 'explore_cluster':
                    content.innerHTML = renderExploreCluster();
                    break;
                case 'major_detail':
                    content.innerHTML = renderMajorDetail();
                    break;
                case 'schools':
                    content.innerHTML = renderSchools();
                    break;
                default:
                    content.innerHTML = renderWelcome();
            }
        }

        function renderWelcome() {
            return `
                <div class="hs-title">
                    <h1>Let's Explore What You Enjoy Doing</h1>
                    <p>No right or wrong answers. This is not about what you're "good at" — just what feels like you right now.</p>
                </div>
                <div class="hs-card">
                    <div style="font-size: 0.875rem; color: #334155; line-height: 1.5rem;">
                        You'll answer a few quick statements about what you enjoy.<br>
                        Then you can choose <strong>2–4 areas</strong> to explore more deeply.<br><br>
                        <strong>It's normal</strong> for more than one area to stand out.
                    </div>
                    <button class="hs-btn hs-btn-primary" style="margin-top: 1rem;" onclick="startPass1()">Start</button>
                </div>
                <div style="margin-top: 1rem; font-size: 0.75rem; color: #64748b;">
                    CloverPath High School Assessment
                </div>
            `;
        }

        function renderPass1() {
            const domain = domains[state.pass1.index];
            const total = domains.length;
            const progress = Math.round(((state.pass1.index + 1) / total) * 100);
            const currentAnswer = state.pass1.answers[domain.id];

            return `
                <div class="hs-progress-wrapper">
                    <div class="hs-progress-label">
                        <span>Progress</span>
                        <span>${progress}%</span>
                    </div>
                    <div class="hs-progress-bar">
                        <div class="hs-progress-fill" style="width: ${progress}%"></div>
                    </div>
                </div>

                <div class="hs-title">
                    <h1>Quick Check-In</h1>
                    <p>How much does this sound like you right now?</p>
                </div>

                <div class="hs-card">
                    <div style="margin-bottom: 0.5rem;">
                        <span class="hs-pill">${state.pass1.index + 1} / ${total}</span>
                    </div>
                    
                    <div style="font-size: 1.125rem; font-weight: 600; line-height: 1.5rem;">${domain.title}</div>
                    
                    <div class="hs-prompt">"${domain.prompt}"</div>

                    <div class="hs-options">
                        ${PASS1_SCALE.map(opt => `
                            <button 
                                class="hs-option-btn ${currentAnswer === opt.value ? 'selected' : ''}"
                                onclick="setPass1Answer('${domain.id}', ${opt.value})">
                                ${opt.label}
                            </button>
                        `).join('')}
                    </div>

                    <div class="hs-btn-container">
                        <button 
                            class="hs-btn hs-btn-secondary hs-btn-half" 
                            onclick="previousPass1()"
                            ${state.pass1.index === 0 ? 'disabled' : ''}>
                            ← Back
                        </button>
                        <button 
                            class="hs-btn hs-btn-primary hs-btn-half" 
                            onclick="nextPass1()"
                            ${currentAnswer === undefined ? 'disabled' : ''}>
                            ${state.pass1.index === total - 1 ? 'Finish' : 'Next →'}
                        </button>
                    </div>

                    <div class="hs-helper-text">
                        Don't overthink it — your first reaction is usually best.
                    </div>
                </div>
            `;
        }

        function renderPass1Results() {
            const strong = domains.filter(d => state.pass1.answers[d.id] === 3);
            const some = domains.filter(d => state.pass1.answers[d.id] === 2);
            const selectedCount = state.selectedDomains.size;

            return `
                <div class="hs-title">
                    <h1>A Few Areas That Stood Out</h1>
                    <p>It's normal for more than one area to resonate. Choose 2–4 to explore more deeply right now.</p>
                </div>

                <div class="hs-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 0.875rem; color: #334155;">
                            Selected: <strong>${selectedCount}</strong> / 4
                        </div>
                        <span class="hs-badge ${selectedCount >= 2 && selectedCount <= 4 ? 'hs-badge-default' : 'hs-badge-secondary'}">
                            ${selectedCount >= 2 && selectedCount <= 4 ? 'Ready' : 'Pick 2–4'}
                        </span>
                    </div>

                    <div class="hs-separator"></div>

                    <div class="hs-section-header">Strongly resonated</div>
                    <div class="hs-options">
                        ${strong.length === 0 ? 
                            '<div style="font-size: 0.875rem; color: #475569;">No worries — that\'s common. Check the "Somewhat" section below.</div>' :
                            strong.map(d => `
                                <div class="hs-checkbox-option" onclick="toggleDomain('${d.id}')">
                                    <input type="checkbox" class="hs-checkbox" ${state.selectedDomains.has(d.id) ? 'checked' : ''} onchange="event.stopPropagation()">
                                    <div class="hs-checkbox-label">${d.title}</div>
                                </div>
                            `).join('')
                        }
                    </div>

                    <div class="hs-section-header">Somewhat resonated</div>
                    <div class="hs-options">
                        ${some.length === 0 ? 
                            '<div style="font-size: 0.875rem; color: #475569;">That\'s okay too — you can pick from any area below.</div>' :
                            some.map(d => `
                                <div class="hs-checkbox-option" onclick="toggleDomain('${d.id}')">
                                    <input type="checkbox" class="hs-checkbox" ${state.selectedDomains.has(d.id) ? 'checked' : ''} onchange="event.stopPropagation()">
                                    <div class="hs-checkbox-label">${d.title}</div>
                                </div>
                            `).join('')
                        }
                    </div>

                    <div style="margin-top: 1.25rem;">
                        <details>
                            <summary>See all areas</summary>
                            <div class="hs-options" style="margin-top: 0.75rem;">
                                ${domains.map(d => `
                                    <div class="hs-checkbox-option" onclick="toggleDomain('${d.id}')">
                                        <input type="checkbox" class="hs-checkbox" ${state.selectedDomains.has(d.id) ? 'checked' : ''} onchange="event.stopPropagation()">
                                        <div class="hs-checkbox-label">${d.title}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </details>
                    </div>

                    <button 
                        class="hs-btn hs-btn-primary" 
                        style="margin-top: 1rem;"
                        onclick="continueToPass2()"
                        ${selectedCount < 2 || selectedCount > 4 ? 'disabled' : ''}>
                        Continue to deeper exploration
                    </button>
                    
                    <div class="hs-helper-text">
                        You can explore more later — this is just what you want to focus on right now.
                    </div>
                </div>
            `;
        }

        function renderPass2() {
            const domainId = state.pass2.order[state.pass2.index];
            const domain = domains.find(d => d.id === domainId);
            const module = pass2Modules[domainId];
            
            const progress = Math.round(((state.pass2.index + 1) / state.pass2.order.length) * 100);
            const answer = state.pass2.answers[domainId] || { 
                activities: [], 
                style: null, 
                motivations: [], 
                frustration: null, 
                reflect: null 
            };

            const isComplete = answer.activities.length > 0 && 
                             answer.style && 
                             answer.motivations.length > 0 && 
                             answer.frustration && 
                             answer.reflect;

            return `
                <div class="hs-progress-wrapper">
                    <div class="hs-progress-label">
                        <span>Progress</span>
                        <span>${progress}%</span>
                    </div>
                    <div class="hs-progress-bar">
                        <div class="hs-progress-fill" style="width: ${progress}%"></div>
                    </div>
                </div>

                <div class="hs-title">
                    <h1>${domain.title}</h1>
                    <p>Explore what parts feel interesting — no pressure to decide anything.</p>
                </div>

                <div class="hs-card">
                    <div class="hs-prompt">${module.intro}</div>

                    <div class="hs-section-header">1) Which of these sound interesting?</div>
                    <div class="hs-options">
                        ${module.activities.map(activity => `
                            <div class="hs-checkbox-option" onclick="toggleActivity('${domainId}', '${activity.replace(/'/g, "\\'")}')">
                                <input type="checkbox" class="hs-checkbox" ${answer.activities.includes(activity) ? 'checked' : ''} onchange="event.stopPropagation()">
                                <div class="hs-checkbox-label">${activity}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="hs-section-header">2) ${module.envStyle.q}</div>
                    <div class="hs-radio-group">
                        ${module.envStyle.options.map(opt => `
                            <div class="hs-radio-option">
                                <input type="radio" class="hs-radio" name="style-${domainId}" id="style-${domainId}-${opt.key}" 
                                    ${answer.style === opt.key ? 'checked' : ''}
                                    onchange="setStyle('${domainId}', '${opt.key}')">
                                <label class="hs-radio-label" for="style-${domainId}-${opt.key}">${opt.label}</label>
                            </div>
                        `).join('')}
                    </div>

                    <div class="hs-section-header">3) What would feel most rewarding?</div>
                    <div class="hs-section-subheader">Choose up to 2</div>
                    <div class="hs-options">
                        ${module.motivations.map(motivation => `
                            <div class="hs-checkbox-option" onclick="toggleMotivation('${domainId}', '${motivation.replace(/'/g, "\\'")}')">
                                <input type="checkbox" class="hs-checkbox" ${answer.motivations.includes(motivation) ? 'checked' : ''} onchange="event.stopPropagation()">
                                <div class="hs-checkbox-label">${motivation}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="hs-section-header">4) Which would be most frustrating?</div>
                    <div class="hs-radio-group">
                        ${module.frustrations.map((frustration, idx) => `
                            <div class="hs-radio-option">
                                <input type="radio" class="hs-radio" name="frustration-${domainId}" id="frustration-${domainId}-${idx}" 
                                    ${answer.frustration === frustration ? 'checked' : ''}
                                    onchange="setFrustration('${domainId}', '${frustration.replace(/'/g, "\\'")}')">
                                <label class="hs-radio-label" for="frustration-${domainId}-${idx}">${frustration}</label>
                            </div>
                        `).join('')}
                    </div>

                    <div class="hs-section-header">5) Which feels closest right now?</div>
                    <div class="hs-radio-group">
                        ${[
                            "I want to explore this more.",
                            "Parts of this are interesting, but I'm unsure.",
                            "I don't think this is for me.",
                            "I'm still figuring it out."
                        ].map((reflection, idx) => `
                            <div class="hs-radio-option">
                                <input type="radio" class="hs-radio" name="reflect-${domainId}" id="reflect-${domainId}-${idx}" 
                                    ${answer.reflect === reflection ? 'checked' : ''}
                                    onchange="setReflection('${domainId}', '${reflection.replace(/'/g, "\\'")}')">
                                <label class="hs-radio-label" for="reflect-${domainId}-${idx}">${reflection}</label>
                            </div>
                        `).join('')}
                    </div>

                    <div class="hs-btn-container">
                        <button 
                            class="hs-btn hs-btn-secondary hs-btn-half" 
                            onclick="previousPass2()">
                            ← Back
                        </button>
                        <button 
                            class="hs-btn hs-btn-primary hs-btn-half" 
                            onclick="nextPass2()"
                            ${!isComplete ? 'disabled' : ''}>
                            ${state.pass2.index === state.pass2.order.length - 1 ? 'Finish' : 'Next →'}
                        </button>
                    </div>

                    <div class="hs-helper-text">
                        Tip: It's okay to be unsure. Exploring helps you learn what you like.
                    </div>
                </div>
            `;
        }

        function renderClusters() {
            const clusterList = state.surfacedClusters.map(id => clusters.find(c => c.id === id)).filter(Boolean);

            return `
                <div class="hs-title">
                    <h1>Where Your Interests Often Show Up</h1>
                    <p>These aren't recommendations — just areas students often explore based on similar preferences.</p>
                </div>

                <div class="hs-card">
                    <div style="display: grid; gap: 0.75rem;">
                        ${clusterList.map(cluster => `
                            <div class="hs-cluster-card" onclick="exploreCluster('${cluster.id}')">
                                <div class="hs-cluster-title">${cluster.title}</div>
                                <div class="hs-cluster-desc">${cluster.about}</div>
                                <div class="hs-cluster-hint">Tap to explore</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="hs-helper-text" style="margin-top: 1rem;">
                        Your interests can change — and that's okay. This is about exploration, not deciding.
                    </div>
                </div>
            `;
        }

        function renderExploreCluster() {
            const cluster = clusters.find(c => c.id === state.activeCluster);
            if (!cluster) return '<div>Cluster not found</div>';

            return `
                <div class="hs-title">
                    <h1>${cluster.title}</h1>
                    <p>This is context to help you explore — not a decision.</p>
                </div>

                <div class="hs-card">
                    <div style="font-size: 0.875rem; color: #334155; line-height: 1.5rem;">
                        ${cluster.about}
                    </div>

                    <div class="hs-separator"></div>

                    <div class="hs-section-header">What students often work on</div>
                    <ul class="hs-list">
                        ${cluster.workOn.map(item => `<li>${item}</li>`).join('')}
                    </ul>

                    <div class="hs-section-header">What learning often feels like</div>
                    <ul class="hs-list">
                        ${cluster.learningFeels.map(item => `<li>${item}</li>`).join('')}
                    </ul>

                    <div class="hs-separator"></div>

                    <div class="hs-section-header">Example majors students explore</div>
                    <div style="font-size: 0.875rem; color: #475569; margin-bottom: 0.5rem;">
                        Click a major to learn more and see schools
                    </div>
                    <div class="hs-options">
                        ${cluster.majors.slice(0, 5).map(major => `
                            <button class="hs-option-btn" onclick="exploreMajor('${major}')">
                                ${major}
                            </button>
                        `).join('')}
                    </div>

                    <div class="hs-btn-container" style="margin-top: 1rem;">
                        <button class="hs-btn hs-btn-ghost" onclick="backToClusters()">
                            ← Back to clusters
                        </button>
                    </div>

                    <div class="hs-helper-text">
                        Liking something is a reason to explore it — not proof you need to be good at it yet.
                    </div>
                </div>
            `;
        }

        function renderMajorDetail() {
            if (!state.activeMajor) return '<div>Major not found</div>';
            
            const cluster = clusters.find(c => c.id === state.activeMajor.clusterId);
            const majorName = state.activeMajor.name;

            return `
                <div class="hs-title">
                    <h1>${majorName}</h1>
                    <p>A quick, student-friendly overview to help you explore.</p>
                </div>

                <div class="hs-card">
                    <div class="hs-prompt">
                        ${majorName} is a major students explore within ${cluster.title}. This gives you an idea of what it often looks like in school.
                    </div>

                    <div class="hs-separator"></div>

                    <div class="hs-section-header">What you'll usually study</div>
                    <ul class="hs-list">
                        <li>Core concepts and fundamentals</li>
                        <li>Hands-on projects and applications</li>
                        <li>Skills specific to this field</li>
                    </ul>

                    <div class="hs-section-header">What to try in high school</div>
                    <ul class="hs-list">
                        <li>Look up intro courses from college websites</li>
                        <li>Join related clubs or activities</li>
                        <li>Talk to someone who studies or works in this field</li>
                    </ul>

                    <button class="hs-btn hs-btn-primary" style="margin-top: 1rem;" onclick="exploreSchools()">
                        Explore schools by region
                    </button>

                    <button class="hs-btn hs-btn-ghost" style="margin-top: 0.5rem;" onclick="backToCluster()">
                        ← Back
                    </button>
                </div>
            `;
        }

        function renderSchools() {
            if (!state.activeMajor) return '<div>Major not found</div>';
            
            const cluster = clusters.find(c => c.id === state.activeMajor.clusterId);
            const regions = ['West', 'Midwest', 'Northeast', 'South'];

            if (!state.schoolsData.region) {
                return `
                    <div class="hs-title">
                        <h1>Schools to Explore</h1>
                        <p>Examples of programs for ${state.activeMajor.name} (not rankings)</p>
                    </div>

                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 0.75rem;">
                        ${state.activeMajor.name} is commonly explored within ${cluster.title}.
                    </div>

                    <div class="hs-card">
                        <div class="hs-section-header">Choose a region</div>
                        <div class="hs-options">
                            ${regions.map(region => `
                                <button class="hs-region-btn" onclick="selectRegion('${region}')">
                                    ${region}
                                </button>
                            `).join('')}
                        </div>

                        <button class="hs-btn hs-btn-ghost" style="margin-top: 1rem;" onclick="backToMajor()">
                            ← Back
                        </button>
                    </div>
                `;
            }

            return `
                <div class="hs-title">
                    <h1>Schools in ${state.schoolsData.region}</h1>
                    <p>${state.activeMajor.name} programs (via U.S. Dept of Education)</p>
                </div>

                <div class="hs-card">
                    ${state.schoolsData.loading ? `
                        <div class="hs-loading">Loading schools from College Scorecard...</div>
                    ` : `
                        ${state.schoolsData.schools.length === 0 ? `
                            <div style="font-size: 0.875rem; color: #475569;">
                                No schools found. Try a different region.
                            </div>
                        ` : `
                            <div style="display: grid; gap: 0.5rem;">
                                ${state.schoolsData.schools.map(school => `
                                    <div class="hs-school-item">
                                        <div class="hs-school-name">${school.name}</div>
                                        ${school.location ? `<div style="font-size: 0.75rem; color: #64748b;">${school.location}</div>` : ''}
                                        <div class="hs-school-note">${school.note}</div>
                                        ${school.url ? `<a href="${school.url}" target="_blank" style="font-size: 0.75rem; color: #008208;">Visit website →</a>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    `}

                    <button class="hs-btn hs-btn-secondary" style="margin-top: 1rem;" onclick="changeRegion()">
                        Change region
                    </button>

                    <button class="hs-btn hs-btn-ghost" style="margin-top: 0.5rem;" onclick="backToMajor()">
                        ← Back to major
                    </button>
                </div>
            `;
        }

        // ========================================
        // EVENT HANDLERS
        // ========================================

        function restartAssessment() {
            if (confirm('Are you sure you want to restart? All progress will be lost.')) {
                state.screen = 'welcome';
                state.pass1 = { index: 0, answers: {} };
                state.selectedDomains = new Set();
                state.pass2 = { order: [], index: 0, answers: {} };
                state.surfacedClusters = [];
                state.lastClusterId = null;
                state.activeCluster = null;
                state.activeMajor = null;
                state.comparePair = null;
                state.schoolsData = { region: null, loading: false, schools: [] };
                render();
            }
        }

        function startPass1() {
            state.screen = 'pass1';
            render();
        }

        function setPass1Answer(domainId, value) {
            state.pass1.answers[domainId] = value;
            render();
        }

        function previousPass1() {
            if (state.pass1.index > 0) {
                state.pass1.index--;
                render();
            }
        }

        function nextPass1() {
            if (state.pass1.index < domains.length - 1) {
                state.pass1.index++;
                render();
            } else {
                state.screen = 'pass1_results';
                const preselected = new Set();
                domains.forEach(d => {
                    if (state.pass1.answers[d.id] >= 2) {
                        preselected.add(d.id);
                    }
                });
                state.selectedDomains = preselected;
                render();
            }
        }

        function toggleDomain(domainId) {
            if (state.selectedDomains.has(domainId)) {
                state.selectedDomains.delete(domainId);
            } else {
                if (state.selectedDomains.size < 4) {
                    state.selectedDomains.add(domainId);
                }
            }
            render();
        }

        function continueToPass2() {
            state.pass2.order = Array.from(state.selectedDomains);
            state.pass2.index = 0;
            state.screen = 'pass2';
            render();
        }

        function toggleActivity(domainId, activity) {
            if (!state.pass2.answers[domainId]) {
                state.pass2.answers[domainId] = { activities: [], style: null, motivations: [], frustration: null, reflect: null };
            }
            const activities = state.pass2.answers[domainId].activities;
            const index = activities.indexOf(activity);
            if (index > -1) {
                activities.splice(index, 1);
            } else {
                activities.push(activity);
            }
            render();
        }

        function setStyle(domainId, style) {
            if (!state.pass2.answers[domainId]) {
                state.pass2.answers[domainId] = { activities: [], style: null, motivations: [], frustration: null, reflect: null };
            }
            state.pass2.answers[domainId].style = style;
            render();
        }

        function toggleMotivation(domainId, motivation) {
            if (!state.pass2.answers[domainId]) {
                state.pass2.answers[domainId] = { activities: [], style: null, motivations: [], frustration: null, reflect: null };
            }
            const motivations = state.pass2.answers[domainId].motivations;
            const index = motivations.indexOf(motivation);
            if (index > -1) {
                motivations.splice(index, 1);
            } else {
                if (motivations.length < 2) {
                    motivations.push(motivation);
                }
            }
            render();
        }

        function setFrustration(domainId, frustration) {
            if (!state.pass2.answers[domainId]) {
                state.pass2.answers[domainId] = { activities: [], style: null, motivations: [], frustration: null, reflect: null };
            }
            state.pass2.answers[domainId].frustration = frustration;
            render();
        }

        function setReflection(domainId, reflection) {
            if (!state.pass2.answers[domainId]) {
                state.pass2.answers[domainId] = { activities: [], style: null, motivations: [], frustration: null, reflect: null };
            }
            state.pass2.answers[domainId].reflect = reflection;
            render();
        }

        function previousPass2() {
            if (state.pass2.index > 0) {
                state.pass2.index--;
                render();
            } else {
                state.screen = 'pass1_results';
                render();
            }
        }

        function nextPass2() {
            if (state.pass2.index < state.pass2.order.length - 1) {
                state.pass2.index++;
                render();
            } else {
                finishPass2();
            }
        }

        function finishPass2() {
            const surfaced = new Set();
            state.pass2.order.forEach(domainId => {
                const baseClusters = domainBaseClusters[domainId] || [];
                baseClusters.forEach(c => surfaced.add(c));
            });
            state.surfacedClusters = clusters.map(c => c.id).filter(id => surfaced.has(id));
            state.lastClusterId = state.surfacedClusters[0] || null;
            state.screen = 'clusters';
            render();
        }

        function exploreCluster(clusterId) {
            state.activeCluster = clusterId;
            state.lastClusterId = clusterId;
            state.screen = 'explore_cluster';
            render();
        }

        function exploreMajor(majorName) {
            state.activeMajor = { name: majorName, clusterId: state.activeCluster };
            state.screen = 'major_detail';
            render();
        }

        function exploreSchools() {
            state.schoolsData.region = null;
            state.schoolsData.schools = [];
            state.screen = 'schools';
            render();
        }

        function selectRegion(region) {
            state.schoolsData.region = region;
            render();
            if (state.activeMajor) {
                fetchSchoolsByMajor(state.activeMajor.name, state.activeMajor.clusterId, region);
            }
        }

        function changeRegion() {
            state.schoolsData.region = null;
            state.schoolsData.schools = [];
            render();
        }

        function backToMajor() {
            state.schoolsData.region = null;
            state.schoolsData.schools = [];
            state.screen = 'major_detail';
            render();
        }

        function backToCluster() {
            state.screen = 'explore_cluster';
            render();
        }

        function backToClusters() {
            state.activeCluster = null;
            state.activeMajor = null;
            state.screen = 'clusters';
            render();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            render();
        });
    </script>
</body>
</html>
