<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High School Major Exploration | CloverPath</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to bottom, #ffffff, #f8fafc);
            min-height: 100vh;
            color: #0f172a;
        }
        .hs-container { max-width: 672px; margin: 0 auto; padding: 1rem; }
        @media (min-width: 768px) { .hs-container { padding: 1.5rem; } }
        .hs-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem; }
        .hs-header-title { font-size: 0.75rem; font-weight: 600; color: #475569; }
        .hs-restart-btn { border: 1px solid #e2e8f0; background: white; border-radius: 9999px; padding: 0.25rem 0.75rem; font-size: 0.75rem; color: #334155; cursor: pointer; transition: background-color 0.2s; }
        .hs-restart-btn:hover { background-color: #f8fafc; }
        .hs-card { background: white; border-radius: 1rem; border: 1px solid #e2e8f0; padding: 1rem; margin-bottom: 1rem; }
        .hs-title { margin-bottom: 1rem; }
        .hs-title h1 { font-size: 1.5rem; font-weight: 600; letter-spacing: -0.025em; }
        .hs-title p { margin-top: 0.25rem; font-size: 0.875rem; color: #475569; }
        .hs-progress-wrapper { margin-bottom: 1rem; }
        .hs-progress-label { display: flex; justify-content: space-between; font-size: 0.75rem; color: #475569; margin-bottom: 0.5rem; }
        .hs-progress-bar { width: 100%; height: 0.5rem; background-color: #e2e8f0; border-radius: 0.25rem; overflow: hidden; }
        .hs-progress-fill { height: 100%; background-color: #008208; transition: width 0.3s ease; }
        .hs-pill { display: inline-flex; align-items: center; background-color: #f1f5f9; border-radius: 9999px; padding: 0.25rem 0.625rem; font-size: 0.75rem; color: #334155; }
        .hs-prompt { background-color: #f8fafc; border-radius: 0.75rem; padding: 0.75rem; font-size: 0.875rem; color: #1e293b; margin: 0.5rem 0; }
        .hs-btn { width: 100%; padding: 0.75rem; border-radius: 0.75rem; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; }
        .hs-btn-primary { background-color: #0f172a; color: white; }
        .hs-btn-primary:hover:not(:disabled) { background-color: #1e293b; }
        .hs-btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .hs-btn-secondary { background-color: white; color: #0f172a; border: 1px solid #e2e8f0; }
        .hs-btn-secondary:hover { background-color: #f8fafc; }
        .hs-btn-ghost { background-color: transparent; color: #0f172a; }
        .hs-btn-ghost:hover { background-color: #f8fafc; }
        .hs-options { display: grid; gap: 0.5rem; margin: 1rem 0; }
        .hs-option-btn { width: 100%; padding: 0.75rem; border-radius: 0.75rem; font-size: 0.875rem; text-align: left; cursor: pointer; border: 1px solid #e2e8f0; background-color: white; color: #1e293b; transition: all 0.2s; }
        .hs-option-btn:hover { background-color: #f8fafc; }
        .hs-option-btn.selected { background-color: #0f172a; color: white; border-color: #0f172a; }
        .hs-checkbox-option { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.75rem; border-radius: 0.75rem; border: 1px solid #e2e8f0; background-color: white; cursor: pointer; transition: background-color 0.2s; }
        .hs-checkbox-option:hover { background-color: #f8fafc; }
        .hs-checkbox { width: 1rem; height: 1rem; margin-top: 0.125rem; flex-shrink: 0; cursor: pointer; }
        .hs-checkbox-label { font-size: 0.875rem; line-height: 1.25rem; }
        .hs-radio-group { display: grid; gap: 0.75rem; background-color: white; border: 1px solid #e2e8f0; border-radius: 0.75rem; padding: 0.75rem; }
        .hs-radio-option { display: flex; align-items: flex-start; gap: 0.5rem; }
        .hs-radio { width: 1rem; height: 1rem; margin-top: 0.25rem; flex-shrink: 0; cursor: pointer; }
        .hs-radio-label { font-size: 0.875rem; line-height: 1.25rem; cursor: pointer; }
        .hs-btn-container { display: flex; gap: 0.5rem; margin-top: 1rem; }
        .hs-btn-half { width: 50%; }
        .hs-helper-text { font-size: 0.75rem; color: #64748b; margin-top: 0.75rem; }
        .hs-separator { height: 1px; background-color: #e2e8f0; margin: 1rem 0; }
        .hs-badge { display: inline-flex; align-items: center; padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-size: 0.75rem; font-weight: 500; }
        .hs-badge-default { background-color: #0f172a; color: white; }
        .hs-badge-secondary { background-color: #f1f5f9; color: #334155; }
        .hs-cluster-card { border-radius: 1rem; border: 1px solid #e2e8f0; background-color: white; padding: 1rem; cursor: pointer; transition: background-color 0.2s; }
        .hs-cluster-card:hover { background-color: #f8fafc; }
        .hs-cluster-title { font-size: 1rem; font-weight: 600; }
        .hs-cluster-desc { margin-top: 0.25rem; font-size: 0.875rem; color: #334155; line-height: 1.25rem; }
        .hs-cluster-hint { margin-top: 0.5rem; font-size: 0.75rem; color: #64748b; }
        .hs-list { margin-top: 0.5rem; padding-left: 1.25rem; list-style-type: disc; }
        .hs-list li { font-size: 0.875rem; color: #334155; line-height: 1.5rem; }
        .hs-section-header { font-size: 0.875rem; font-weight: 600; margin-top: 1.25rem; margin-bottom: 0.5rem; }
        .hs-section-header:first-child { margin-top: 0; }
        .hs-section-subheader { font-size: 0.75rem; color: #64748b; margin-bottom: 0.5rem; }
        .hidden { display: none !important; }
        details { border: 1px solid #e2e8f0; border-radius: 0.75rem; background-color: white; padding: 0.75rem; margin-top: 0.75rem; }
        summary { cursor: pointer; font-size: 0.875rem; font-weight: 600; }
        .hs-school-item { border-radius: 0.75rem; border: 1px solid #e2e8f0; background-color: white; padding: 0.75rem; margin-bottom: 0.5rem; }
        .hs-school-name { font-size: 0.875rem; font-weight: 600; }
        .hs-school-note { font-size: 0.75rem; color: #475569; }
        .hs-region-btn { width: 100%; padding: 0.75rem; border-radius: 0.75rem; font-size: 0.875rem; cursor: pointer; border: 1px solid #e2e8f0; background-color: white; transition: all 0.2s; }
        .hs-region-btn:hover { background-color: #f8fafc; }
        .hs-loading { text-align: center; padding: 2rem; color: #64748b; font-size: 0.875rem; }
        .hs-comparison-grid { display: grid; gap: 1rem; margin-top: 1rem; }
        @media (min-width: 768px) { .hs-comparison-grid { grid-template-columns: 1fr 1fr; } }
        .hs-comparison-card { border: 1px solid #e2e8f0; border-radius: 1rem; padding: 1rem; background-color: white; }
        .hs-comparison-header { font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem; }
        .hs-info-note { background-color: #f0fdf4; border: 1px solid #86efac; border-radius: 0.75rem; padding: 0.75rem; font-size: 0.875rem; margin-bottom: 1rem; color: #166534; }
    </style>
</head>
<body>
    <div class="hs-container">
        <div class="hs-header">
            <div class="hs-header-title">HS Major Exploration · CloverPath</div>
            <button class="hs-restart-btn hidden" onclick="restartAssessment()">Restart</button>
        </div>
        <div id="app-content"></div>
    </div>
    <script>

// ========================================
// CONFIGURATION - UPDATE THESE VALUES
// ========================================

// Supabase Configuration - CONFIGURED ✅
const SUPABASE_URL = 'https://clhuplhaejneecbyhphh.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsaHVwbGhhZWpuZWVjYnlocGhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2Mzc5OTksImV4cCI6MjA3NjIxMzk5OX0.ropRR6Izmcy1sRV5v9HDDvBTlCTTGnJcLUvdSyYloBI';

// ========================================
// STATE MANAGEMENT
// ========================================

const state = {
    screen: 'welcome',
    pass1: { index: 0, answers: {} },
    selectedDomains: new Set(),
    pass2: { order: [], index: 0, answers: {} },
    surfacedClusters: [],
    lastClusterId: null,
    activeCluster: null,
    activeMajor: null,
    showAllMajors: false,
    comparePair: null,
    schoolsData: { region: null, loading: false, schools: [] }
};

// ========================================
// DATA STRUCTURES
// ========================================

const PASS1_SCALE = [
    { value: 3, label: "Sounds a lot like me" },
    { value: 2, label: "Sounds somewhat like me" },
    { value: 1, label: "Not really me" },
    { value: 0, label: "Doesn't sound like me at all" }
];

const domains = [
  {
    id: "build_make",
    title: "Building & Making Things",
    prompt: "I like building things, putting stuff together, or making something that actually works.",
  },
  {
    id: "fix_hands",
    title: "Fixing, Crafting & Working with Your Hands",
    prompt:
      "I enjoy working with my hands — fixing things, crafting, cooking, or learning practical skills.",
  },
  {
    id: "analyze_solve",
    title: "Analyzing & Solving Problems",
    prompt:
      "I like figuring things out, solving problems, or breaking something down to understand how it works.",
  },
  {
    id: "create_express",
    title: "Creating & Expressing Ideas",
    prompt:
      "I enjoy expressing ideas through writing, art, music, video, or creative projects.",
  },
  {
    id: "perform_entertain",
    title: "Performing & Entertaining",
    prompt:
      "I like performing, being on stage, entertaining people, or expressing myself live.",
  },
  {
    id: "help_support",
    title: "Helping & Supporting People",
    prompt:
      "I enjoy helping others, supporting people, or making a positive difference in someone’s life.",
  },
  {
    id: "teach_coach",
    title: "Teaching, Coaching & Explaining",
    prompt:
      "I like explaining things, helping others learn, or coaching people to improve.",
  },
  {
    id: "lead_sell",
    title: "Leading, Influencing & Making Things Happen",
    prompt:
      "I enjoy getting people on board with an idea, organizing groups, or helping a plan actually move forward.",
  },
  {
    id: "organize_track",
    title: "Organizing & Keeping Things on Track",
    prompt:
      "I like organizing details, following steps, and making sure things run smoothly.",
  },
  {
    id: "compete_train",
    title: "Competing, Training & Pushing Yourself",
    prompt:
      "I enjoy competition, training, pushing myself physically, or performing under pressure.",
  },
  {
    id: "outdoors_animals",
    title: "Exploring the Outdoors & Working with Animals",
    prompt:
      "I like being outdoors, working with animals, or learning about nature and the environment.",
  },
  {
    id: "explore_research",
    title: "Exploring, Researching & Discovering",
    prompt:
      "I’m curious and like exploring new ideas, asking big questions, or learning how the world works.",
  },
  {
    id: "design_better",
    title: "Designing Experiences & Making Things Better",
    prompt:
      "I like noticing how things feel for people — like spaces, apps, or products — and thinking about how to make them better.",
  },
];

const clusters = [
  {
    id: "eng_tech",
    title: "Engineering & Technology",
    about:
      "Designing, building, and improving how things work — from machines and structures to technology.",
    enjoy:
      "Solving practical problems, testing solutions, improving designs over time.",
    majors: [
      "Mechanical Engineering",
      "Electrical Engineering",
      "Civil Engineering",
      "Engineering Technology",
      "Industrial Engineering",
    ],
    workOn: [
      "Designing something on paper or on a computer before it’s built",
      "Building prototypes or models and improving them",
      "Testing different fixes to see what works",
      "Using math or science ideas to choose between options",
    ],
    learningFeels: [
      "A mix of problem-solving, projects, and some theory",
      "Planning before building",
      "Trying, learning from mistakes, and trying again",
    ],
  },
  {
    id: "cs_data",
    title: "Computer, Data & Information Fields",
    about:
      "Working with computers, data, and digital information to solve problems or build tools people use.",
    enjoy:
      "Logical thinking, coding, finding patterns, building digital solutions.",
    majors: [
      "Computer Science",
      "Information Systems",
      "Data Science",
      "Cybersecurity",
      "Information Technology",
    ],
    workOn: [
      "Building simple apps, games, or websites",
      "Using data to answer questions",
      "Debugging: figuring out why something isn’t working",
      "Designing tools that make tasks easier",
    ],
    learningFeels: [
      "Lots of practice and projects",
      "Step-by-step problem solving",
      "Testing ideas quickly and improving",
    ],
  },
  {
    id: "sci",
    title: "Physical & Life Sciences",
    about:
      "Understanding how the natural world works — including physics, chemistry, biology, and related sciences.",
    enjoy: "Asking \"why\" questions, experimenting, analyzing results, discovery.",
    majors: ["Biology", "Chemistry", "Physics", "Biochemistry", "Neuroscience"],
    workOn: [
      "Running experiments or labs",
      "Collecting and analyzing data",
      "Investigating questions about the natural world",
      "Learning how living or physical systems behave",
    ],
    learningFeels: [
      "Lab work and research projects",
      "Careful observation and analysis",
      "Open-ended questions that take time",
    ],
  },
  {
    id: "biz",
    title: "Business, Economics & Entrepreneurship",
    about:
      "How organizations and markets work — and how ideas turn into products, services, or businesses.",
    enjoy:
      "Decision-making, leadership, persuasion, understanding how value is created.",
    majors: [
      "Business Administration",
      "Economics",
      "Finance",
      "Marketing",
      "Management",
      "Entrepreneurship",
    ],
    workOn: [
      "Planning projects or running group activities",
      "Making decisions about resources and tradeoffs",
      "Pitching ideas or convincing others",
      "Solving problems that affect customers or teams",
    ],
    learningFeels: [
      "Group projects and real-world examples",
      "Discussing choices and explaining why",
      "Balancing people, money, and time constraints",
    ],
  },
  {
    id: "social",
    title: "Social Sciences",
    about:
      "Understanding people, groups, and societies — how they think, behave, and interact.",
    enjoy:
      "Learning about behavior and culture, analyzing how societies change.",
    majors: [
      "Psychology",
      "Sociology",
      "Anthropology",
      "Political Science",
      "Human Geography",
    ],
    workOn: [
      "Asking questions about people and behavior",
      "Reading and discussing different viewpoints",
      "Using surveys, interviews, or studies to learn",
      "Connecting patterns to real-world issues",
    ],
    learningFeels: [
      "Discussion-heavy learning",
      "Writing and explaining your thinking",
      "Often more than one reasonable answer",
    ],
  },
  {
    id: "comm",
    title: "Communication, Media & Design",
    about:
      "Sharing ideas and information through writing, visuals, media, and design.",
    enjoy:
      "Storytelling, communication, design, understanding how messages affect people.",
    majors: [
      "Communication Studies",
      "Graphic Design",
      "Digital Media",
      "Journalism",
      "Advertising",
      "Public Relations",
    ],
    workOn: [
      "Creating videos, graphics, or content",
      "Designing posters, websites, or social media",
      "Writing stories or messages",
      "Thinking about what will connect with an audience",
    ],
    learningFeels: [
      "Creative projects and presentations",
      "Feedback and revision",
      "Balancing creativity with clarity",
    ],
  },
  {
    id: "arts",
    title: "Arts & Performing Arts",
    about:
      "Expressing ideas and emotions through performance or artistic creation.",
    enjoy:
      "Performing, rehearsing, creating art or music, sharing work with others.",
    majors: [
      "Visual Arts",
      "Music",
      "Theater",
      "Dance",
      "Film Production",
      "Creative Writing",
    ],
    workOn: [
      "Practicing or rehearsing performances",
      "Creating art, music, writing, or film",
      "Building a portfolio of work",
      "Collaborating on productions or shows",
    ],
    learningFeels: [
      "A lot of practice and feedback",
      "Creative risk-taking",
      "Comfort being seen and evaluated",
    ],
  },
  {
    id: "health",
    title: "Health & Human Services",
    about:
      "Supporting people’s health, well-being, and quality of life.",
    enjoy:
      "Helping others directly, making a meaningful difference, structured environments.",
    majors: [
      "Nursing",
      "Public Health",
      "Health Sciences",
      "Social Work",
      "Human Services",
      "Kinesiology",
    ],
    workOn: [
      "Supporting people through challenges",
      "Learning about health and well-being",
      "Working in structured settings with responsibility",
      "Team-based problem solving around people’s needs",
    ],
    learningFeels: [
      "People-centered learning",
      "Clear standards and responsibilities",
      "Practice-based learning (simulations, placements)",
    ],
  },
  {
    id: "edu",
    title: "Education & Learning Sciences",
    about:
      "Helping people learn, grow, and improve through teaching, coaching, or training.",
    enjoy:
      "Explaining ideas, mentoring others, planning lessons, supporting learning.",
    majors: [
      "Education",
      "Elementary Education",
      "Secondary Education",
      "Special Education",
      "Educational Psychology",
    ],
    workOn: [
      "Explaining concepts in different ways",
      "Coaching others to improve",
      "Planning activities that help learning",
      "Working with different learning styles",
    ],
    learningFeels: [
      "Communication-heavy",
      "Practice + reflection",
      "Patience and relationship-building",
    ],
  },
  {
    id: "env",
    title: "Environmental & Earth Sciences",
    about:
      "Studying the Earth, the environment, and how people interact with natural systems.",
    enjoy:
      "Nature, sustainability, fieldwork, environmental challenges.",
    majors: [
      "Environmental Studies",
      "Environmental Science",
      "Earth Science",
      "Geology",
      "Sustainability Studies",
    ],
    workOn: [
      "Learning about ecosystems and environmental change",
      "Collecting information outdoors or in labs",
      "Exploring sustainability solutions",
      "Understanding how humans impact nature",
    ],
    learningFeels: [
      "A mix of science and real-world issues",
      "Sometimes fieldwork or outdoor learning",
      "Big-picture thinking about impacts",
    ],
  },
  {
    id: "civic",
    title: "Public Policy, Law & Civic Fields",
    about:
      "How rules, laws, and public decisions are made — and how they affect communities.",
    enjoy:
      "Debating issues, fairness, writing and discussion, community problem-solving.",
    majors: [
      "Political Science",
      "Public Policy",
      "Legal Studies",
      "Criminal Justice",
      "International Relations",
      "Public Administration",
    ],
    workOn: [
      "Discussing and debating real issues",
      "Understanding rules and how they work",
      "Writing persuasive arguments",
      "Thinking about fairness and impact",
    ],
    learningFeels: [
      "Reading and writing a lot",
      "Discussion and viewpoints",
      "Often more than one reasonable answer",
    ],
  },
  {
    id: "skilled",
    title: "Skilled & Applied Technical Fields",
    about:
      "Hands-on, applied learning focused on building, fixing, or maintaining real-world systems and equipment.",
    enjoy:
      "Working with tools, learning by doing, seeing results quickly.",
    majors: [
      "Automotive Technology",
      "Construction Management",
      "Electrical / Mechanical Technology",
      "Welding / Manufacturing Technology",
      "HVAC Technology",
      "Culinary Arts",
    ],
    workOn: [
      "Fixing or installing real equipment",
      "Working with tools and machines",
      "Building or repairing things directly",
      "Solving practical problems with immediate impact",
    ],
    learningFeels: [
      "Hands-on classes (labs/shops)",
      "Learning by doing",
      "Practicing skills to improve",
    ],
  },
];

const domainBaseClusters = {
  build_make: ["eng_tech", "skilled"],
  fix_hands: ["skilled"],
  analyze_solve: ["eng_tech", "cs_data", "sci", "biz"],
  create_express: ["comm", "arts"],
  perform_entertain: ["arts"],
  help_support: ["health", "social"],
  teach_coach: ["edu", "health"],
  lead_sell: ["biz", "comm", "civic"],
  organize_track: ["biz", "skilled", "civic"],
  compete_train: ["health", "edu", "biz"],
  outdoors_animals: ["env", "sci"],
  explore_research: ["sci", "social", "env"],
  design_better: ["comm", "eng_tech", "cs_data"],
};

const pass2Modules = {
  design_better: {
    intro:
      "This area is about noticing how things feel for people — like spaces, apps, events, or products — and thinking about how to improve them.",
    activities: [
      "Noticing when an app, website, or game feels confusing to use",
      "Rearranging a space to make it feel better or work better",
      "Planning events so people have a good experience",
      "Improving something that works but feels awkward",
      "Getting annoyed when things are poorly designed",
    ],
    envStyle: {
      q: "If you were doing something like this, which setting sounds more appealing?",
      options: [
        { key: "team", label: "Working on a team, bouncing ideas around, improving things together" },
        { key: "solo", label: "Working on your own first, then sharing once ideas are formed" },
        { key: "mix", label: "A mix of both" },
      ],
    },
    motivations: [
      "Seeing people enjoy using something you improved",
      "Making something feel simpler or easier to use",
      "Solving a problem that was bothering people",
      "Having creative freedom",
      "Knowing your change actually helped someone",
      "I’m not sure yet",
    ],
    frustrations: [
      "Explaining your ideas to others",
      "Getting feedback and making changes",
      "Not having one right answer",
      "Paying attention to small details",
      "Working within limits (time, rules, budgets)",
      "None of these bother me much",
    ],
  },
  compete_train: {
    intro:
      "This area is about challenging yourself, training to improve, and performing under pressure. You don’t need to be a varsity athlete — just explore what parts feel like you.",
    activities: [
      "Training regularly to get better at something",
      "Competing against others or yourself",
      "Performing well under pressure (games, events)",
      "Pushing through discomfort to improve",
      "Being part of a team working toward a goal",
      "Tracking progress over time",
    ],
    envStyle: {
      q: "Which situation feels more appealing?",
      options: [
        { key: "clear", label: "Clear goals, rules, and feedback (you know how you’re doing)" },
        { key: "open", label: "Open-ended challenges where outcomes aren’t always clear" },
        { key: "mix", label: "A mix of both" },
      ],
    },
    motivations: [
      "Trying to beat a personal best",
      "Winning or performing better than others",
      "Being part of a team",
      "The structure and routine of training",
      "Feeling strong, capable, or disciplined",
      "I’m not sure yet",
    ],
    frustrations: [
      "Strict schedules or routines",
      "Repetitive training",
      "Physical discomfort or fatigue",
      "Losing or not performing well",
      "Pressure to perform in front of others",
      "None of these really bother me",
    ],
  },
  analyze_solve: {
    intro:
      "This area is about figuring things out — noticing patterns, solving puzzles, and breaking problems into parts. You don’t need to be a \"math person\" to explore it.",
    activities: [
      "Solving puzzles, logic problems, or brain teasers",
      "Figuring out why something isn’t working",
      "Looking for patterns in numbers or information",
      "Breaking a big problem into smaller steps",
      "Comparing options to decide what makes sense",
      "Enjoying questions with clear answers",
    ],
    envStyle: {
      q: "Which kind of problem sounds more appealing?",
      options: [
        { key: "rules", label: "Problems with clear rules and right answers" },
        { key: "messy", label: "Messy problems with lots of unknowns" },
        { key: "mix", label: "A mix of both" },
      ],
    },
    motivations: [
      "Reaching a clear solution",
      "Knowing your answer is correct",
      "Understanding how something works",
      "Making decisions based on logic",
      "Finding the most efficient way to do something",
      "I’m not sure yet",
    ],
    frustrations: [
      "Problems with no clear solution",
      "Explaining your thinking to others",
      "Working with incomplete or messy information",
      "Spending a long time on one problem",
      "Having your solution questioned",
      "None of these really bother me",
    ],
  },

  // Remaining modules (solid, concise)
  build_make: {
    intro:
      "This area is about making things — building, putting parts together, and enjoying the satisfaction of something working.",
    activities: [
      "Building a project and seeing it work",
      "Following steps to assemble something",
      "Improving a design after testing it",
      "Using tools (digital or physical) to make something real",
      "Fixing small issues until it works better",
    ],
    envStyle: {
      q: "Which sounds more fun?",
      options: [
        { key: "hands", label: "Hands-on building and testing" },
        { key: "plan", label: "Planning first, then building" },
        { key: "mix", label: "A mix of both" },
      ],
    },
    motivations: [
      "Seeing a finished result",
      "Making something useful",
      "Solving a practical challenge",
      "Working with tools or tech",
      "Learning by doing",
      "I’m not sure yet",
    ],
    frustrations: [
      "Things breaking and needing fixes",
      "Details and measurements",
      "Long projects",
      "Working with rules or safety steps",
      "Not having the right materials",
      "None of these bother me",
    ],
  },
  fix_hands: {
    intro:
      "This area is about hands-on skills — fixing, crafting, cooking, and learning practical ways to make things work.",
    activities: [
      "Fixing something that’s broken",
      "Learning how tools or machines work",
      "Practicing a skill to get better",
      "Following steps to get a clean result",
      "Making something with your hands (food, crafts, repairs)",
    ],
    envStyle: {
      q: "Which setting sounds better?",
      options: [
        { key: "shop", label: "Learning in a lab/shop/kitchen with hands-on practice" },
        { key: "class", label: "Learning mostly in a classroom with notes and tests" },
        { key: "mix", label: "A mix" },
      ],
    },
    motivations: [
      "Seeing results quickly",
      "Feeling skilled and capable",
      "Helping others by fixing real problems",
      "Working with tools or materials",
      "Making something that works",
      "I’m not sure yet",
    ],
    frustrations: [
      "Repetitive practice",
      "Messy work or cleanup",
      "Strict safety rules",
      "Very detailed steps",
      "Working slowly for precision",
      "None of these bother me",
    ],
  },
  create_express: {
    intro:
      "This area is about expressing ideas — through art, writing, music, video, or creative projects.",
    activities: [
      "Making art, writing, music, or videos",
      "Coming up with original ideas",
      "Telling stories or sharing a point of view",
      "Designing something that looks and feels right",
      "Experimenting with style or aesthetics",
    ],
    envStyle: {
      q: "Which feels more like you?",
      options: [
        { key: "freedom", label: "Lots of creative freedom and personal style" },
        { key: "brief", label: "A clear brief or prompt to design around" },
        { key: "mix", label: "A mix" },
      ],
    },
    motivations: [
      "Expressing yourself",
      "Making something beautiful or meaningful",
      "Getting a reaction from an audience",
      "Telling a story",
      "Trying new styles",
      "I’m not sure yet",
    ],
    frustrations: [
      "Creative blocks",
      "Feedback that changes your vision",
      "Deadlines",
      "Not knowing if it’s good",
      "Having to present your work",
      "None of these bother me",
    ],
  },
  perform_entertain: {
    intro:
      "This area is about performing — being on stage, entertaining, and expressing yourself live.",
    activities: [
      "Performing music, acting, dance, or speaking",
      "Rehearsing to improve",
      "Being part of a cast or ensemble",
      "Expressing emotion through performance",
      "Feeding off an audience’s energy",
    ],
    envStyle: {
      q: "Which environment sounds better?",
      options: [
        { key: "spotlight", label: "Being featured (more spotlight)" },
        { key: "group", label: "Being part of a group performance" },
        { key: "mix", label: "A mix" },
      ],
    },
    motivations: [
      "Being on stage",
      "Entertaining people",
      "Improving through practice",
      "Working with a group",
      "Expressing yourself",
      "I’m not sure yet",
    ],
    frustrations: [
      "Stage nerves",
      "Rehearsals and repetition",
      "Critiques",
      "Auditions",
      "Performing when you don’t feel ready",
      "None of these bother me",
    ],
  },
  help_support: {
    intro:
      "This area is about helping people — supporting others and making a positive difference.",
    activities: [
      "Listening and supporting someone",
      "Helping someone solve a problem",
      "Volunteering or serving your community",
      "Being the person others rely on",
      "Working in teams where people matter",
    ],
    envStyle: {
      q: "Which feels better?",
      options: [
        { key: "direct", label: "Helping people directly, one-on-one" },
        { key: "behind", label: "Helping behind the scenes (planning, organizing support)" },
        { key: "mix", label: "A mix" },
      ],
    },
    motivations: [
      "Making a difference",
      "Being needed and helpful",
      "Working with people",
      "Solving real problems",
      "Feeling connected to a mission",
      "I’m not sure yet",
    ],
    frustrations: [
      "Emotionally heavy situations",
      "People not taking advice",
      "Slow progress",
      "Conflict",
      "Lots of rules or paperwork",
      "None of these bother me",
    ],
  },
  teach_coach: {
    intro:
      "This area is about helping others learn — explaining, coaching, mentoring, and helping people improve.",
    activities: [
      "Explaining a concept in a simple way",
      "Helping someone practice and improve",
      "Planning learning activities",
      "Being patient with questions",
      "Giving feedback that helps",
    ],
    envStyle: {
      q: "Which feels better?",
      options: [
        { key: "kids", label: "Working with kids/teens" },
        { key: "peers", label: "Working with peers/adults" },
        { key: "mix", label: "A mix" },
      ],
    },
    motivations: [
      "Seeing someone improve",
      "Explaining things clearly",
      "Leading a group",
      "Building confidence in others",
      "Helping people reach goals",
      "I’m not sure yet",
    ],
    frustrations: [
      "Repeating yourself",
      "People not trying",
      "Managing attention or behavior",
      "Planning lessons",
      "Being responsible for others",
      "None of these bother me",
    ],
  },
  lead_sell: {
    intro:
      "This area is about helping ideas turn into action — getting people on board, organizing efforts, and moving things forward.",
    activities: [
      "Leading a group project or club activity",
      "Getting people excited about an idea or plan",
      "Organizing an event, fundraiser, or team effort",
      "Speaking up to influence a decision",
      "Taking initiative when something needs to happen",
    ],
    envStyle: {
      q: "Which role sounds more like you?",
      options: [
        { key: "front", label: "Being out front (presenting ideas, motivating people)" },
        { key: "ops", label: "Organizing behind the scenes (planning, coordinating)" },
        { key: "mix", label: "A mix of both" },
      ],
    },
    motivations: [
      "Seeing an idea actually happen",
      "Bringing people together",
      "Taking responsibility for outcomes",
      "Solving problems quickly",
      "Building something new",
      "I’m not sure yet",
    ],
    frustrations: [
      "People not following through",
      "Disagreements or pushback",
      "Having to speak up a lot",
      "Slow decision-making",
      "Messy group dynamics",
      "None of these bother me",
    ],
  },
  organize_track: {
    intro:
      "This area is about keeping things running smoothly — organizing details, following steps, and making sure nothing falls through the cracks.",
    activities: [
      "Making checklists and plans",
      "Keeping a group organized",
      "Following a process to get a clean result",
      "Noticing small mistakes and fixing them",
      "Keeping schedules and deadlines on track",
    ],
    envStyle: {
      q: "Which feels better?",
      options: [
        { key: "clear", label: "Clear steps and expectations" },
        { key: "flex", label: "Flexible plans and changing tasks" },
        { key: "mix", label: "A mix" },
      ],
    },
    motivations: [
      "Feeling organized",
      "Making things run smoothly",
      "Helping a team succeed",
      "Clear rules and steps",
      "Being reliable",
      "I’m not sure yet",
    ],
    frustrations: [
      "Disorganization",
      "Last-minute changes",
      "Unclear instructions",
      "People being late or unprepared",
      "Too much chaos",
      "None of these bother me",
    ],
  },
  outdoors_animals: {
    intro:
      "This area is about the outdoors, animals, and the environment — being in nature and learning how it works.",
    activities: [
      "Spending time outdoors",
      "Working with animals",
      "Learning about ecosystems and nature",
      "Helping protect the environment",
      "Doing hands-on outdoor projects",
    ],
    envStyle: {
      q: "Which sounds better?",
      options: [
        { key: "field", label: "Being outside / fieldwork" },
        { key: "lab", label: "Indoor labs / research" },
        { key: "mix", label: "A mix" },
      ],
    },
    motivations: [
      "Being outside",
      "Helping animals or nature",
      "Learning how nature works",
      "Solving environmental problems",
      "Hands-on projects",
      "I’m not sure yet",
    ],
    frustrations: [
      "Bad weather",
      "Long outdoor days",
      "Messy work",
      "Lots of rules or permits",
      "Not seeing results quickly",
      "None of these bother me",
    ],
  },
  explore_research: {
    intro:
      "This area is about curiosity — exploring new ideas, asking big questions, and learning how the world works.",
    activities: [
      "Researching a topic you’re curious about",
      "Asking why questions",
      "Reading and learning about new ideas",
      "Doing experiments or investigations",
      "Exploring big questions with no easy answer",
    ],
    envStyle: {
      q: "Which feels better?",
      options: [
        { key: "deep", label: "Going deep on one topic" },
        { key: "wide", label: "Exploring lots of topics" },
        { key: "mix", label: "A mix" },
      ],
    },
    motivations: [
      "Discovery",
      "Understanding how things work",
      "Asking big questions",
      "Learning for its own sake",
      "Finding evidence",
      "I’m not sure yet",
    ],
    frustrations: [
      "No clear answers",
      "Slow progress",
      "Lots of reading",
      "Too many details",
      "Having to prove everything",
      "None of these bother me",
    ],
  },
};

const majorCatalog = {
  "Computer Science": {
    title: "Computer Science",
    whatItIs:
      "Computer Science is about creating solutions with code. You learn how computers work, how software is built, and how to solve problems step by step.",
    whatYouStudy: [
      "Coding (building programs that do things)",
      "Problem-solving and logic",
      "How data is stored and used",
      "How to design and test software",
    ],
    whatProjectsFeelLike: [
      "Building a simple app, game, or website",
      "Fixing bugs and improving your code",
      "Working on projects where you try, test, and improve",
    ],
    goodToKnow: [
      "You don’t have to be a ‘genius’ — consistency matters more than perfection.",
      "A lot of learning happens through practice and projects.",
    ],
    careerExamples: [
      "Software developer / app builder",
      "Cybersecurity analyst",
      "Data analyst / data scientist (with more study)",
      "Game developer (with interest in games)",
    ],
    tryItInHS: [
      "Try a beginner coding course (Scratch → Python/JavaScript)",
      "Build a small project (calculator, simple website, mini game)",
      "Join a coding club or robotics team",
    ],
  },
  "Mechanical Engineering": {
    title: "Mechanical Engineering",
    whatItIs:
      "Mechanical Engineering is about designing and improving physical things — like machines, devices, and moving systems. You learn to plan, test, and improve designs.",
    whatYouStudy: [
      "Forces, motion, and how things move",
      "Designing parts and systems",
      "Materials (what things are made of)",
      "Testing and improving prototypes",
    ],
    whatProjectsFeelLike: [
      "Designing something, building a model, and improving it",
      "Solving practical problems with math and science ideas",
      "Working on longer projects that go through versions",
    ],
    goodToKnow: [
      "It often uses math and physics, but projects make it feel more real.",
      "Engineering is usually plan → build → test → improve.",
    ],
    careerExamples: [
      "Product or device engineer",
      "Manufacturing / production engineer",
      "Robotics / automation engineer",
      "Automotive / aerospace engineering (with interest)",
    ],
    tryItInHS: [
      "Join robotics, engineering, or maker clubs",
      "Try CAD/design tools or build kits",
      "Do a project where you design and test something (bridge, launcher, model)",
    ],
  },
  "Nursing": {
    title: "Nursing",
    whatItIs:
      "Nursing focuses on caring for people’s health and well-being. You learn how the body works, how to support patients, and how to make decisions in real situations.",
    whatYouStudy: [
      "Human body basics and health",
      "Patient care and communication",
      "Safety and responsibility",
      "Working as part of a care team",
    ],
    whatProjectsFeelLike: [
      "Hands-on practice (simulations, skills labs)",
      "Learning how to respond in real situations",
      "Balancing care with rules and safety steps",
    ],
    goodToKnow: [
      "It’s people-centered and can be emotionally demanding.",
      "You build confidence through practice and structure.",
    ],
    careerExamples: [
      "Registered nurse (hospital, clinic, school)",
      "Specialty nursing (pediatrics, ER, etc.)",
      "Public health or community health roles",
    ],
    tryItInHS: [
      "Volunteer in community health settings if possible",
      "Take health/science classes that interest you",
      "Talk with a nurse about what the day-to-day is like",
    ],
  },
  "Graphic Design": {
    title: "Graphic Design",
    whatItIs:
      "Graphic Design is about communicating ideas visually — using layout, typography, color, and visuals to make messages clear and appealing.",
    whatYouStudy: [
      "Design basics (layout, color, type)",
      "Visual communication and storytelling",
      "Design tools (like Adobe or similar)",
      "Giving and receiving feedback",
    ],
    whatProjectsFeelLike: [
      "Designing posters, logos, social posts, or layouts",
      "Making multiple versions and improving with feedback",
      "Balancing creativity with clear communication",
    ],
    goodToKnow: [
      "Design is often iterative — you revise a lot.",
      "A portfolio (examples of your work) matters.",
    ],
    careerExamples: [
      "Graphic designer",
      "Brand / visual designer",
      "UI/UX designer (with more focus on experience)",
      "Marketing / content design roles",
    ],
    tryItInHS: [
      "Make a few designs for real uses (club flyer, poster, social post)",
      "Try free design tools and learn basics",
      "Build a small portfolio folder",
    ],
  },
};

function generateMajorInfo(majorName, clusterId) {
  const cluster = clusters.find((c) => c.id === clusterId);
  const clusterTitle = cluster?.title || "this area";

  // Helper to build a consistent structure
  const base = {
    title: majorName,
    whatItIs: `${majorName} is a major students explore within ${clusterTitle}. Here’s what it often looks like in school — in plain language.`,
    whatYouStudy: [
      "Intro basics (the foundation of the field)",
      "Skills that help you solve problems in this area",
      "Projects that apply what you learn",
    ],
    whatProjectsFeelLike: [
      "Learning basics first, then applying them in projects",
      "Practice + feedback + improvement over time",
    ],
    goodToKnow: [
      "Majors can look a little different depending on the school.",
      "You don’t need to decide now — the point is to explore.",
    ],
    careerExamples: [
      "Different roles connect to this major (there are many paths)",
      "People often combine this major with internships, clubs, or projects",
    ],
    tryItInHS: [
      "Look up an intro course description from a college website",
      "Try a small project or club related to this area",
      "Talk to someone who studies or works in this field",
    ],
  };

  // Cluster-specific tightening
  if (clusterId === "eng_tech") {
    base.whatItIs =
      "Engineering majors are about designing and improving how physical things work — like machines, structures, and systems. You learn to plan, test, and improve designs.";
    base.whatYouStudy = [
      "Math + science used to solve real problems",
      "Design (planning before building)",
      "Materials and how parts behave",
      "Testing, modeling, and improving prototypes",
    ];
    base.whatProjectsFeelLike = [
      "Design → build a model/prototype → test → improve",
      "Team projects with real constraints (time, budget, materials)",
    ];
    base.goodToKnow = [
      "It can be math-heavy, but projects help make it feel real.",
      "A lot of engineering is iteration: you rarely get it perfect on the first try.",
    ];
    base.careerExamples = [
      "Design / product engineering",
      "Manufacturing / production engineering",
      "Quality / testing roles",
      "Field engineering / technical support roles",
    ];
    base.tryItInHS = [
      "Join robotics, engineering, or maker clubs",
      "Try CAD/design tools or build kits",
      "Do a build-and-test project (bridge, launcher, model)",
    ];

    const name = majorName.toLowerCase();
    if (name.includes("electrical")) {
      base.whatItIs =
        "Electrical Engineering focuses on electricity, circuits, and electronics — how power and signals move through devices.";
      base.whatYouStudy = [
        "Circuits and electronics (how devices are built)",
        "Signals, sensors, and control systems",
        "Power and energy systems",
        "Hands-on labs building and testing circuits",
      ];
      base.careerExamples = [
        "Electrical / electronics engineer",
        "Power / energy engineer",
        "Embedded systems / hardware engineer",
        "Automation / controls roles",
      ];
      base.tryItInHS = [
        "Try basic electronics kits (circuits, Arduino)",
        "Join robotics or engineering club",
        "Build a simple sensor or LED project",
      ];
    } else if (name.includes("civil")) {
      base.whatItIs =
        "Civil Engineering focuses on designing and improving the built world — like bridges, roads, buildings, and water systems.";
      base.whatYouStudy = [
        "Structures and materials (how things stay strong)",
        "Construction basics and planning",
        "Transportation systems (roads, traffic, transit)",
        "Water and environmental systems",
      ];
      base.careerExamples = [
        "Civil / structural engineer",
        "Construction project roles",
        "Transportation planning/engineering",
        "Environmental engineering roles",
      ];
      base.tryItInHS = [
        "Do a bridge/structure build-and-test challenge",
        "Notice infrastructure around you (roads, drainage, buildings)",
        "Try CAD or model-building projects",
      ];
    } else if (name.includes("industrial")) {
      base.whatItIs =
        "Industrial Engineering focuses on making systems run better — improving processes, reducing waste, and making work more efficient.";
      base.whatYouStudy = [
        "Process improvement and efficiency",
        "Data and decision-making for operations",
        "Supply chain and logistics basics",
        "Quality and systems thinking",
      ];
      base.careerExamples = [
        "Industrial / process engineer",
        "Operations / continuous improvement roles",
        "Supply chain / logistics analyst",
        "Quality / systems roles",
      ];
      base.tryItInHS = [
        "Try optimizing a process (club event, workflow) and measuring improvement",
        "Track steps/time in a routine and redesign it",
        "Learn basic spreadsheets and data thinking",
      ];
    } else if (name.includes("technology")) {
      base.whatItIs =
        "Engineering Technology is more hands-on and applied — you learn engineering ideas while spending more time in labs and practical projects.";
      base.whatYouStudy = [
        "Applied engineering concepts",
        "Hands-on labs and testing",
        "Using tools, equipment, and measurement",
        "Troubleshooting and improving real systems",
      ];
      base.careerExamples = [
        "Engineering technologist",
        "Manufacturing / testing roles",
        "Field technician / field engineer pathways",
        "Quality / lab roles",
      ];
      base.tryItInHS = [
        "Take hands-on STEM electives (shop, engineering, robotics)",
        "Build and test practical projects",
        "Try internships/job-shadowing in technical settings",
      ];
    }
  }

  if (clusterId === "cs_data") {
    base.whatItIs =
      "Computer and data majors are about using technology to solve problems — with code, data, networks, and digital tools.";
    base.whatYouStudy = [
      "Coding and problem-solving",
      "How data is stored, cleaned, and used",
      "How computer systems and networks work",
      "Building and testing digital projects",
    ];
    base.whatProjectsFeelLike = [
      "Building apps, tools, or data projects",
      "Debugging and improving your work",
      "Lots of practice — you learn by doing",
    ];
    base.goodToKnow = [
      "You build skill through repetition — it’s normal to get stuck at first.",
      "Projects matter a lot (they show what you can do).",
    ];
    base.careerExamples = [
      "Software / web developer",
      "Data analyst",
      "Cybersecurity roles",
      "IT / systems roles",
    ];
    base.tryItInHS = [
      "Try a beginner coding course and build a small project",
      "Do a data mini-project (sports stats, music data, etc.)",
      "Join a coding/robotics club",
    ];

    const name = majorName.toLowerCase();
    if (name.includes("information systems")) {
      base.whatItIs =
        "Information Systems mixes business and tech — you learn how organizations use technology to run better.";
      base.whatYouStudy = [
        "Databases and how information is organized",
        "Business processes and how systems support them",
        "Project planning and teamwork",
        "Basic coding or tech tools (varies by program)",
      ];
      base.careerExamples = [
        "Business / systems analyst",
        "IT project roles",
        "Product operations / tech operations",
        "Data / reporting roles",
      ];
    } else if (name.includes("data science")) {
      base.whatItIs =
        "Data Science is about using data to answer questions and make decisions. You learn statistics, coding, and how to find patterns.";
      base.whatYouStudy = [
        "Statistics and probability",
        "Coding for data (often Python/R)",
        "Data cleaning and visualization",
        "Intro machine learning concepts",
      ];
      base.careerExamples = [
        "Data analyst",
        "Data scientist (often with more study)",
        "Business intelligence roles",
        "Analytics roles in many industries",
      ];
      base.tryItInHS = [
        "Analyze a dataset (sports, movies, school survey) in a spreadsheet",
        "Learn basic Python and make simple charts",
        "Try a stats or AP math class if it interests you",
      ];
    } else if (name.includes("cyber")) {
      base.whatItIs =
        "Cybersecurity is about protecting computers, networks, and information. You learn how attacks happen and how to defend systems.";
      base.whatYouStudy = [
        "Networks (how computers connect)",
        "Security basics and common threats",
        "Safe practices and risk thinking",
        "Hands-on labs (finding and fixing issues)",
      ];
      base.careerExamples = [
        "Security analyst / SOC roles",
        "IT security and risk roles",
        "Network/security support roles",
        "Security engineering (later)",
      ];
      base.tryItInHS = [
        "Learn basic online safety and networking concepts",
        "Try beginner cybersecurity labs (CTFs)",
        "Join a tech club and explore security topics",
      ];
    } else if (name.includes("information technology") || name === "it") {
      base.whatItIs =
        "Information Technology is about keeping technology running — helping people, managing devices, networks, and systems.";
      base.whatYouStudy = [
        "Computer hardware and software basics",
        "Networks and troubleshooting",
        "User support and problem-solving",
        "Systems setup and maintenance",
      ];
      base.careerExamples = [
        "IT support / help desk",
        "Network technician",
        "Systems administrator (later)",
        "Tech support roles in many settings",
      ];
    }
  }

  if (clusterId === "sci") {
    base.whatItIs =
      "Science majors are about understanding how the natural world works — by asking questions, running experiments, and analyzing results.";
    base.whatYouStudy = [
      "Core science concepts (bio/chem/physics depending on the major)",
      "Lab skills and careful measurement",
      "Data analysis and evidence",
      "Scientific writing and communication",
    ];
    base.whatProjectsFeelLike = [
      "Labs and experiments where results aren’t always predictable",
      "Working carefully and repeating tests",
      "Connecting evidence to conclusions",
    ];
    base.goodToKnow = [
      "Science can be open-ended — patience matters.",
      "Lab work is a big part of many programs.",
    ];
    base.careerExamples = [
      "Lab / research assistant roles",
      "Biotech or lab technician roles",
      "Healthcare pathways (with additional training)",
      "Environmental or science education paths",
    ];
    base.tryItInHS = [
      "Do a science fair or research-style project",
      "Ask a teacher about lab opportunities",
      "Join a science club or related volunteer work",
    ];

    const name = majorName.toLowerCase();
    if (name.includes("chem")) {
      base.whatYouStudy = [
        "Chemistry reactions and how materials change",
        "Lab experiments with careful measurements",
        "Analyzing substances and results",
        "Math used in chemistry (varies by course)",
      ];
    } else if (name.includes("physics")) {
      base.whatYouStudy = [
        "Motion, energy, forces, and electricity",
        "Problem-solving with equations",
        "Labs and experiments",
        "Modeling how the world works",
      ];
    } else if (name.includes("neuro")) {
      base.whatYouStudy = [
        "Brain and nervous system basics",
        "Biology and behavior connections",
        "Research methods and data",
        "Labs or studies depending on program",
      ];
    }
  }

  if (clusterId === "biz") {
    base.whatItIs =
      "Business majors are about how organizations make decisions — with people, money, and plans. You learn how ideas turn into real projects.";
    base.whatYouStudy = [
      "How businesses operate (planning, budgeting, teamwork)",
      "Decision-making with tradeoffs",
      "Communication and persuasion",
      "Real-world examples and projects",
    ];
    base.whatProjectsFeelLike = [
      "Group projects, presentations, and case studies",
      "Making a plan and explaining your choices",
    ];
    base.goodToKnow = [
      "Business is broad — different majors feel very different.",
      "Internships and projects help you learn what you like.",
    ];
    base.careerExamples = [
      "Marketing and customer-focused roles",
      "Finance and money-focused roles",
      "Operations and planning roles",
      "Sales, entrepreneurship, or management paths",
    ];
    base.tryItInHS = [
      "Try a small project: plan an event or fundraiser",
      "Learn basic budgeting in a spreadsheet",
      "Join DECA/FBLA or a business club",
    ];

    const name = majorName.toLowerCase();
    if (name.includes("finance")) {
      base.whatItIs =
        "Finance is about how money moves — budgeting, investing, and making decisions with numbers.";
      base.whatYouStudy = [
        "Budgeting and financial planning",
        "Understanding investments and risk",
        "Using spreadsheets and models",
        "How businesses make money decisions",
      ];
      base.careerExamples = [
        "Financial analyst",
        "Corporate finance roles",
        "Banking / investing pathways",
        "Insurance / risk roles",
      ];
    } else if (name.includes("marketing")) {
      base.whatItIs =
        "Marketing is about connecting products or ideas with people — understanding what audiences want and how to communicate value.";
      base.whatYouStudy = [
        "Branding and messaging",
        "Social media and digital marketing basics",
        "Customer psychology and research",
        "Campaign planning and measurement",
      ];
      base.careerExamples = [
        "Marketing coordinator",
        "Brand / content roles",
        "Digital marketing roles",
        "Sales-support and customer growth roles",
      ];
    } else if (name.includes("economics")) {
      base.whatItIs =
        "Economics is about how choices get made — by people, businesses, and governments — especially when resources are limited.";
      base.whatYouStudy = [
        "How markets work (supply and demand)",
        "Data and graphs to explain trends",
        "How incentives change behavior",
        "Big-picture economic issues",
      ];
      base.careerExamples = [
        "Business / policy analysis roles",
        "Research assistant pathways",
        "Finance or consulting-adjacent paths",
        "Data/analytics roles",
      ];
    } else if (name.includes("entrepreneur")) {
      base.whatItIs =
        "Entrepreneurship is about building something new — turning an idea into a product, service, or project people actually use.";
      base.whatYouStudy = [
        "Testing ideas with real people",
        "Basic finance and planning",
        "Marketing and communication",
        "Building and improving a product/service",
      ];
      base.careerExamples = [
        "Startup founder pathways",
        "Small business roles",
        "Product or project roles",
        "Innovation roles inside companies",
      ];
      base.tryItInHS = [
        "Try a small side project or fundraiser and reflect on what worked",
        "Interview people about a problem they want solved",
        "Join entrepreneurship or business clubs",
      ];
    }
  }

  if (clusterId === "comm") {
    base.whatItIs =
      "Communication and design majors are about sharing ideas clearly — through writing, visuals, media, and storytelling.";
    base.whatYouStudy = [
      "Writing and messaging",
      "Design or media tools (varies by major)",
      "Audience and storytelling",
      "Projects + feedback + revision",
    ];
    base.whatProjectsFeelLike = [
      "Creating content (videos, graphics, writing, campaigns)",
      "Getting feedback and improving multiple versions",
    ];
    base.goodToKnow = [
      "A portfolio (examples of your work) can matter a lot.",
      "You’ll do a lot of creating, revising, and presenting.",
    ];
    base.careerExamples = [
      "Marketing / content roles",
      "Journalism / media roles",
      "Design roles",
      "PR / communications roles",
    ];
    base.tryItInHS = [
      "Run a small project: poster/video/story for a club",
      "Build a portfolio folder (even 6–10 pieces)",
      "Try school newspaper, yearbook, or media clubs",
    ];

    const name = majorName.toLowerCase();
    if (name.includes("journal")) {
      base.whatItIs =
        "Journalism is about reporting and telling true stories — researching, interviewing, and writing clearly.";
      base.whatYouStudy = [
        "Interviewing and research",
        "Writing and editing",
        "Media ethics and fairness",
        "Story structure and clarity",
      ];
      base.careerExamples = [
        "Reporter / journalist",
        "Editor",
        "Content writer",
        "Media producer roles",
      ];
    } else if (name.includes("public relations") || name.includes("pr")) {
      base.whatItIs =
        "Public Relations is about how organizations communicate with the public — building trust, handling announcements, and responding to issues.";
      base.careerExamples = [
        "PR / communications coordinator",
        "Social / community roles",
        "Event communications",
        "Brand communications roles",
      ];
    } else if (name.includes("advert")) {
      base.whatItIs =
        "Advertising is about creating campaigns that get attention — mixing creativity with strategy.";
      base.careerExamples = [
        "Advertising account roles",
        "Creative / copy roles",
        "Media planning roles",
        "Brand campaign roles",
      ];
    } else if (name.includes("digital")) {
      base.whatItIs =
        "Digital Media focuses on creating and publishing content using modern tools — video, social media, and digital storytelling.";
      base.careerExamples = [
        "Content creator / producer",
        "Social media roles",
        "Digital marketing roles",
        "Video / media production roles",
      ];
    }
  }

  if (clusterId === "arts") {
    base.whatItIs =
      "Arts majors focus on creative expression — through performance or making art. You build skill through practice and feedback.";
    base.whatYouStudy = [
      "Technique and practice (lots of repetition)",
      "Creative projects and performance",
      "Feedback and critique",
      "Building a portfolio or reel",
    ];
    base.whatProjectsFeelLike = [
      "Practice/rehearsal + performance or presentation",
      "Creating work and improving it over time",
    ];
    base.goodToKnow = [
      "Your work samples (portfolio/reel) matter.",
      "Consistency and practice are a big part of success.",
    ];
    base.careerExamples = [
      "Artist / performer pathways",
      "Creative production roles",
      "Teaching arts (with additional training)",
      "Creative roles in media and events",
    ];
    base.tryItInHS = [
      "Perform or create regularly (shows, concerts, portfolio pieces)",
      "Ask for feedback and revise",
      "Join school performances or arts clubs",
    ];
  }

  if (clusterId === "health") {
    base.whatItIs =
      "Health and human services majors focus on supporting people’s well-being — often with real responsibility and structured environments.";
    base.whatYouStudy = [
      "Health and human development basics",
      "Communication and care",
      "Ethics, safety, and responsibility",
      "Hands-on practice (varies by major)",
    ];
    base.whatProjectsFeelLike = [
      "Learning how to respond in real situations",
      "Practice through labs, simulations, or placements",
    ];
    base.goodToKnow = [
      "People-centered work can be meaningful — and emotionally demanding.",
      "Many paths require extra training/licensing.",
    ];
    base.careerExamples = [
      "Healthcare roles (clinical and non-clinical)",
      "Community / public health roles",
      "Human services and support roles",
    ];
    base.tryItInHS = [
      "Volunteer in community or health-related settings",
      "Take science/health classes that interest you",
      "Talk to someone in a helping profession",
    ];

    const name = majorName.toLowerCase();
    if (name.includes("public health")) {
      base.whatItIs =
        "Public Health focuses on keeping communities healthy — prevention, education, and health systems.";
      base.careerExamples = [
        "Community health roles",
        "Health education roles",
        "Program coordination",
        "Public health analyst pathways",
      ];
    } else if (name.includes("kines")) {
      base.whatItIs =
        "Kinesiology is about movement and performance — how the body moves, trains, and stays healthy.";
      base.careerExamples = [
        "Sports performance roles",
        "Fitness / coaching pathways",
        "Physical therapy-related paths (with more school)",
        "Wellness and health roles",
      ];
      base.tryItInHS = [
        "Track training and recovery and learn what works",
        "Explore anatomy basics",
        "Volunteer or assist in coaching settings",
      ];
    } else if (name.includes("social work")) {
      base.whatItIs =
        "Social Work is about supporting people through difficult situations — connecting them to resources and helping them navigate challenges.";
      base.careerExamples = [
        "Social worker (often requires licensing)",
        "Case management roles",
        "Community program roles",
        "School or youth support roles",
      ];
    }
  }

  if (clusterId === "edu") {
    base.whatItIs =
      "Education majors focus on helping people learn — teaching, coaching, and supporting different learning needs.";
    base.whatYouStudy = [
      "How people learn",
      "Planning lessons and activities",
      "Communication and classroom skills",
      "Practice teaching and reflection",
    ];
    base.whatProjectsFeelLike = [
      "Designing lessons and trying them",
      "Getting feedback and improving your approach",
    ];
    base.goodToKnow = [
      "Patience and communication matter a lot.",
      "Many teaching paths have certification steps.",
    ];
    base.careerExamples = [
      "Teacher pathways",
      "Special education support roles",
      "Coaching and training roles",
      "Education program roles",
    ];
    base.tryItInHS = [
      "Tutor or mentor someone",
      "Coach younger students or help a club",
      "Lead study groups and notice what works",
    ];
  }

  if (clusterId === "env") {
    base.whatItIs =
      "Environmental and earth majors focus on nature, the planet, and sustainability — using science and problem-solving to understand and improve the environment.";
    base.whatYouStudy = [
      "Ecosystems and environmental change",
      "Earth systems (land, water, climate)",
      "Data and field/lab methods",
      "Sustainability solutions",
    ];
    base.whatProjectsFeelLike = [
      "Sometimes fieldwork (outside) and sometimes lab work",
      "Studying real issues and proposing solutions",
    ];
    base.careerExamples = [
      "Environmental consulting/support roles",
      "Conservation and sustainability roles",
      "Field and lab technician pathways",
      "Policy and advocacy (with interest)",
    ];
    base.tryItInHS = [
      "Join an environmental club or community project",
      "Do a local investigation (water quality, biodiversity)",
      "Volunteer with conservation groups",
    ];

    const name = majorName.toLowerCase();
    if (name.includes("geology")) {
      base.whatItIs =
        "Geology is about the Earth — rocks, landforms, and the forces that shape the planet over time.";
      base.careerExamples = [
        "Geology field roles",
        "Environmental fieldwork roles",
        "Energy/mining-related roles (varies)",
        "Research and lab roles",
      ];
    }
  }

  if (clusterId === "civic") {
    base.whatItIs =
      "Civic and policy majors focus on how rules and decisions affect communities — fairness, law, government, and public systems.";
    base.whatYouStudy = [
      "Government and policy basics",
      "Law and fairness concepts (varies by major)",
      "Writing and argument",
      "Debate and multiple viewpoints",
    ];
    base.whatProjectsFeelLike = [
      "Reading, discussion, and writing a lot",
      "Analyzing issues and proposing solutions",
    ];
    base.goodToKnow = [
      "There are rarely simple answers — you weigh tradeoffs.",
      "Communication and critical thinking matter.",
    ];
    base.careerExamples = [
      "Policy and program roles",
      "Legal-adjacent roles",
      "Public service roles",
      "Advocacy and civic organizations",
    ];
    base.tryItInHS = [
      "Try debate/mock trial or civic clubs",
      "Follow an issue you care about and learn both sides",
      "Volunteer in community organizations",
    ];

    const name = majorName.toLowerCase();
    if (name.includes("criminal")) {
      base.whatItIs =
        "Criminal Justice explores how laws are enforced and how legal systems work — including policing, courts, and corrections.";
    } else if (name.includes("international")) {
      base.whatItIs =
        "International Relations looks at how countries interact — diplomacy, conflict, trade, and global issues.";
    }
  }

  if (clusterId === "social") {
    base.whatItIs =
      "Social science majors focus on understanding people and society — how we think, behave, and organize communities.";
    base.whatYouStudy = [
      "Human behavior and social patterns",
      "Research methods (surveys, studies, interviews)",
      "Writing and explaining ideas",
      "Data and evidence (varies by major)",
    ];
    base.whatProjectsFeelLike = [
      "Reading and discussing perspectives",
      "Writing papers or projects that explain what you found",
    ];
    base.careerExamples = [
      "Research and analysis roles",
      "Community and people-focused roles",
      "Policy and advocacy paths",
      "Counseling/therapy-related paths (with more training)",
    ];
    base.tryItInHS = [
      "Run a small survey or interview project",
      "Join clubs focused on people/issues",
      "Read about psychology or society topics that interest you",
    ];
  }

  if (clusterId === "skilled") {
    base.whatItIs =
      "Skilled and applied technical programs are hands-on. You learn practical skills to build, fix, install, or maintain real equipment and systems.";
    base.whatYouStudy = [
      "Hands-on skills (tools, equipment, safety)",
      "Step-by-step processes and precision",
      "Troubleshooting (find the problem, fix it)",
      "Work habits and professionalism",
    ];
    base.whatProjectsFeelLike = [
      "Learning by doing in labs/shops/kitchens",
      "Practicing skills until they become natural",
      "Seeing results quickly",
    ];
    base.goodToKnow = [
      "These paths are skill-based — practice matters.",
      "Many programs connect directly to apprenticeships or certifications.",
    ];
    base.careerExamples = [
      "Technician and specialist roles",
      "Apprenticeship and certification pathways",
      "Skilled roles across many industries",
    ];
    base.tryItInHS = [
      "Take hands-on electives (shop, culinary, auto) if available",
      "Try a weekend project with tools (safely)",
      "Job-shadow or talk with someone in a trade",
    ];

    const name = majorName.toLowerCase();
    if (name.includes("culinary")) {
      base.whatItIs =
        "Culinary Arts is about cooking skills, kitchen teamwork, and creating quality food consistently.";
      base.careerExamples = [
        "Cook / chef pathways",
        "Restaurant and kitchen management (later)",
        "Catering and food service roles",
        "Food entrepreneurship paths",
      ];
      base.tryItInHS = [
        "Cook at home and learn one skill at a time",
        "Help with events or catering-like projects",
        "Take culinary classes if offered",
      ];
    } else if (name.includes("hvac")) {
      base.whatItIs =
        "HVAC Technology focuses on heating, cooling, and ventilation systems — installing, maintaining, and troubleshooting.";
    } else if (name.includes("welding") || name.includes("manufacturing")) {
      base.whatItIs =
        "Welding/Manufacturing programs focus on building and joining materials safely and precisely — often in industrial settings.";
    } else if (name.includes("automotive")) {
      base.whatItIs =
        "Automotive Technology is about diagnosing, fixing, and maintaining vehicles — using tools, systems knowledge, and troubleshooting.";
    }
  }

  return base;
}


// Add CIP codes for API calls
clusters.forEach(cluster => {
    switch(cluster.id) {
        case 'eng_tech': cluster.cipCodes = ['14']; break;
        case 'cs_data': cluster.cipCodes = ['11']; break;
        case 'sci': cluster.cipCodes = ['26', '40', '41']; break;
        case 'biz': cluster.cipCodes = ['52']; break;
        case 'social': cluster.cipCodes = ['42', '45']; break;
        case 'comm': cluster.cipCodes = ['09', '10', '50']; break;
        case 'arts': cluster.cipCodes = ['50']; break;
        case 'health': cluster.cipCodes = ['51', '44']; break;
        case 'edu': cluster.cipCodes = ['13']; break;
        case 'env': cluster.cipCodes = ['03', '40']; break;
        case 'civic': cluster.cipCodes = ['22', '43', '44', '45']; break;
        case 'skilled': cluster.cipCodes = ['46', '47', '48', '49', '12', '15']; break;
    }
});

// Canonical comparison pairs
const canonicalPairs = [
    ["eng_tech", "cs_data"],
    ["eng_tech", "skilled"],
    ["cs_data", "biz"],
    ["sci", "health"],
    ["biz", "comm"],
    ["social", "civic"],
    ["comm", "arts"],
    ["health", "edu"],
    ["env", "sci"]
];

// ========================================
// SUPABASE API INTEGRATION
// ========================================

async function fetchSchoolsByMajor(majorName, clusterId, region) {
    state.schoolsData.loading = true;
    state.schoolsData.schools = [];
    render();

    try {
        const cluster = clusters.find(c => c.id === clusterId);
        if (!cluster || !cluster.cipCodes) {
            throw new Error('Cluster not found');
        }

        const cipCode = cluster.cipCodes[0];
        const regionMap = { 'West': 8, 'Midwest': 5, 'Northeast': 1, 'South': 5 };
        const regionId = regionMap[region] || 8;
        
        // Call Supabase Edge Function
        const response = await fetch(`${SUPABASE_URL}/functions/v1/fetch-schools`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
            },
            body: JSON.stringify({
                cipCode: cipCode,
                region: regionId
            })
        });

        if (!response.ok) throw new Error('API request failed');
        const data = await response.json();
        
        const schools = data.results
            .filter(school => school['school.name'])
            .slice(0, 8)
            .map(school => {
                let note = '';
                const size = school['latest.student.size'];
                const admissionRate = school['latest.admissions.admission_rate.overall'];
                
                if (size && size > 20000) {
                    note = 'Large public university';
                } else if (size && size > 10000) {
                    note = 'Medium-sized university';
                } else if (size && size > 2000) {
                    note = 'Smaller university';
                } else {
                    note = 'Small college';
                }
                
                if (admissionRate && admissionRate < 0.3) {
                    note += ', selective admissions';
                } else if (admissionRate && admissionRate < 0.6) {
                    note += ', moderately selective';
                }

                return {
                    name: school['school.name'],
                    location: `${school['school.city']}, ${school['school.state']}`,
                    note: note,
                    url: school['school.school_url']
                };
            });

        state.schoolsData.schools = schools;
        state.schoolsData.loading = false;
        render();
        
    } catch (error) {
        console.error('Error fetching schools:', error);
        state.schoolsData.loading = false;
        state.schoolsData.schools = [{
            name: 'Unable to load schools',
            note: 'Check that you have configured SUPABASE_URL and SUPABASE_ANON_KEY at the top of this file, and deployed the Edge Function (see SUPABASE_SETUP.md)'
        }];
        render();
    }
}


// ========================================
// RENDERING FUNCTIONS
// ========================================

function render() {
    const content = document.getElementById('app-content');
    const restartBtn = document.querySelector('.hs-restart-btn');
    
    if (state.screen === 'welcome') {
        restartBtn.classList.add('hidden');
    } else {
        restartBtn.classList.remove('hidden');
    }

    switch (state.screen) {
        case 'welcome':
            content.innerHTML = renderWelcome();
            break;
        case 'pass1':
            content.innerHTML = renderPass1();
            break;
        case 'pass1_results':
            content.innerHTML = renderPass1Results();
            break;
        case 'pass2':
            content.innerHTML = renderPass2();
            break;
        case 'clusters':
            content.innerHTML = renderClusters();
            break;
        case 'explore_cluster':
            content.innerHTML = renderExploreCluster();
            break;
        case 'major_detail':
            content.innerHTML = renderMajorDetail();
            break;
        case 'schools':
            content.innerHTML = renderSchools();
            break;
        case 'compare_picker':
            content.innerHTML = renderComparePicker();
            break;
        case 'compare':
            content.innerHTML = renderComparison();
            break;
        default:
            content.innerHTML = renderWelcome();
    }
}

function renderWelcome() {
    return `
        <div class="hs-title">
            <h1>Let's Explore What You Enjoy Doing</h1>
            <p>No right or wrong answers. This is not about what you're "good at" — just what feels like you right now.</p>
        </div>
        <div class="hs-card">
            <div style="font-size: 0.875rem; color: #334155; line-height: 1.5rem;">
                You'll answer a few quick statements about what you enjoy.<br>
                Then you can choose <strong>2–4 areas</strong> to explore more deeply.<br><br>
                <strong>It's normal</strong> for more than one area to stand out.
            </div>
            <button class="hs-btn hs-btn-primary" style="margin-top: 1rem;" onclick="startPass1()">Start</button>
        </div>
        <div style="margin-top: 1rem; font-size: 0.75rem; color: #64748b;">
            CloverPath High School Assessment
        </div>
    `;
}

function renderPass1() {
    const domain = domains[state.pass1.index];
    const total = domains.length;
    const progress = Math.round(((state.pass1.index + 1) / total) * 100);
    const currentAnswer = state.pass1.answers[domain.id];

    return `
        <div class="hs-progress-wrapper">
            <div class="hs-progress-label">
                <span>Progress</span>
                <span>${progress}%</span>
            </div>
            <div class="hs-progress-bar">
                <div class="hs-progress-fill" style="width: ${progress}%"></div>
            </div>
        </div>

        <div class="hs-title">
            <h1>Quick Check-In</h1>
            <p>How much does this sound like you right now?</p>
        </div>

        <div class="hs-card">
            <div style="margin-bottom: 0.5rem;">
                <span class="hs-pill">${state.pass1.index + 1} / ${total}</span>
            </div>
            
            <div style="font-size: 1.125rem; font-weight: 600; line-height: 1.5rem;">${domain.title}</div>
            
            <div class="hs-prompt">"${domain.prompt}"</div>

            <div class="hs-options">
                ${PASS1_SCALE.map(opt => `
                    <button 
                        class="hs-option-btn ${currentAnswer === opt.value ? 'selected' : ''}"
                        onclick="setPass1Answer('${domain.id}', ${opt.value})">
                        ${opt.label}
                    </button>
                `).join('')}
            </div>

            <div class="hs-btn-container">
                <button 
                    class="hs-btn hs-btn-secondary hs-btn-half" 
                    onclick="previousPass1()"
                    ${state.pass1.index === 0 ? 'disabled' : ''}>
                    ← Back
                </button>
                <button 
                    class="hs-btn hs-btn-primary hs-btn-half" 
                    onclick="nextPass1()"
                    ${currentAnswer === undefined ? 'disabled' : ''}>
                    ${state.pass1.index === total - 1 ? 'Finish' : 'Next →'}
                </button>
            </div>

            <div class="hs-helper-text">
                Don't overthink it — your first reaction is usually best.
            </div>
        </div>
    `;
}

function renderPass1Results() {
    const strong = domains.filter(d => state.pass1.answers[d.id] === 3);
    const some = domains.filter(d => state.pass1.answers[d.id] === 2);
    const selectedCount = state.selectedDomains.size;

    return `
        <div class="hs-title">
            <h1>A Few Areas That Stood Out</h1>
            <p>It's normal for more than one area to resonate. Choose 2–4 to explore more deeply right now.</p>
        </div>

        <div class="hs-card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 0.875rem; color: #334155;">
                    Selected: <strong>${selectedCount}</strong> / 4
                </div>
                <span class="hs-badge ${selectedCount >= 2 && selectedCount <= 4 ? 'hs-badge-default' : 'hs-badge-secondary'}">
                    ${selectedCount >= 2 && selectedCount <= 4 ? 'Ready' : 'Pick 2–4'}
                </span>
            </div>

            <div class="hs-separator"></div>

            <div class="hs-section-header">Strongly resonated</div>
            <div class="hs-options">
                ${strong.length === 0 ? 
                    '<div style="font-size: 0.875rem; color: #475569;">No worries — that\'s common. Check the "Somewhat" section below.</div>' :
                    strong.map(d => `
                        <div class="hs-checkbox-option" onclick="toggleDomain('${d.id}')">
                            <input type="checkbox" class="hs-checkbox" ${state.selectedDomains.has(d.id) ? 'checked' : ''} onchange="event.stopPropagation()">
                            <div class="hs-checkbox-label">${d.title}</div>
                        </div>
                    `).join('')
                }
            </div>

            <div class="hs-section-header">Somewhat resonated</div>
            <div class="hs-options">
                ${some.length === 0 ? 
                    '<div style="font-size: 0.875rem; color: #475569;">That\'s okay too — you can pick from any area below.</div>' :
                    some.map(d => `
                        <div class="hs-checkbox-option" onclick="toggleDomain('${d.id}')">
                            <input type="checkbox" class="hs-checkbox" ${state.selectedDomains.has(d.id) ? 'checked' : ''} onchange="event.stopPropagation()">
                            <div class="hs-checkbox-label">${d.title}</div>
                        </div>
                    `).join('')
                }
            </div>

            <details>
                <summary>See all areas</summary>
                <div class="hs-options" style="margin-top: 0.75rem;">
                    ${domains.map(d => `
                        <div class="hs-checkbox-option" onclick="toggleDomain('${d.id}')">
                            <input type="checkbox" class="hs-checkbox" ${state.selectedDomains.has(d.id) ? 'checked' : ''} onchange="event.stopPropagation()">
                            <div class="hs-checkbox-label">${d.title}</div>
                        </div>
                    `).join('')}
                </div>
            </details>

            <button 
                class="hs-btn hs-btn-primary" 
                style="margin-top: 1rem;"
                onclick="continueToPass2()"
                ${selectedCount < 2 || selectedCount > 4 ? 'disabled' : ''}>
                Continue to deeper exploration
            </button>
            
            <div class="hs-helper-text">
                You can explore more later — this is just what you want to focus on right now.
            </div>
        </div>
    `;
}

function renderPass2() {
    const domainId = state.pass2.order[state.pass2.index];
    const domain = domains.find(d => d.id === domainId);
    const module = pass2Modules[domainId];
    
    const progress = Math.round(((state.pass2.index + 1) / state.pass2.order.length) * 100);
    const answer = state.pass2.answers[domainId] || { 
        activities: [], 
        style: null, 
        motivations: [], 
        frustration: null, 
        reflect: null 
    };

    const isComplete = answer.activities.length > 0 && 
                     answer.style && 
                     answer.motivations.length > 0 && 
                     answer.frustration && 
                     answer.reflect;

    return `
        <div class="hs-progress-wrapper">
            <div class="hs-progress-label">
                <span>Progress</span>
                <span>${progress}%</span>
            </div>
            <div class="hs-progress-bar">
                <div class="hs-progress-fill" style="width: ${progress}%"></div>
            </div>
        </div>

        <div class="hs-title">
            <h1>${domain.title}</h1>
            <p>Explore what parts feel interesting — no pressure to decide anything.</p>
        </div>

        <div class="hs-card">
            <div class="hs-prompt">${module.intro}</div>

            <div class="hs-section-header">1) Which of these sound interesting?</div>
            <div class="hs-options">
                ${module.activities.map(activity => `
                    <div class="hs-checkbox-option" onclick="toggleActivity('${domainId}', \`${activity.replace(/`/g, '\`')}\`)">
                        <input type="checkbox" class="hs-checkbox" ${answer.activities.includes(activity) ? 'checked' : ''} onchange="event.stopPropagation()">
                        <div class="hs-checkbox-label">${activity}</div>
                    </div>
                `).join('')}
            </div>

            <div class="hs-section-header">2) ${module.envStyle.q}</div>
            <div class="hs-radio-group">
                ${module.envStyle.options.map(opt => `
                    <div class="hs-radio-option">
                        <input type="radio" class="hs-radio" name="style-${domainId}" id="style-${domainId}-${opt.key}" 
                            ${answer.style === opt.key ? 'checked' : ''}
                            onchange="setStyle('${domainId}', '${opt.key}')">
                        <label class="hs-radio-label" for="style-${domainId}-${opt.key}">${opt.label}</label>
                    </div>
                `).join('')}
            </div>

            <div class="hs-section-header">3) What would feel most rewarding?</div>
            <div class="hs-section-subheader">Choose up to 2</div>
            <div class="hs-options">
                ${module.motivations.map(motivation => `
                    <div class="hs-checkbox-option" onclick="toggleMotivation('${domainId}', \`${motivation.replace(/`/g, '\`')}\`)">
                        <input type="checkbox" class="hs-checkbox" ${answer.motivations.includes(motivation) ? 'checked' : ''} onchange="event.stopPropagation()">
                        <div class="hs-checkbox-label">${motivation}</div>
                    </div>
                `).join('')}
            </div>

            <div class="hs-section-header">4) Which would be most frustrating?</div>
            <div class="hs-radio-group">
                ${module.frustrations.map((frustration, idx) => `
                    <div class="hs-radio-option">
                        <input type="radio" class="hs-radio" name="frustration-${domainId}" id="frustration-${domainId}-${idx}" 
                            ${answer.frustration === frustration ? 'checked' : ''}
                            onchange="setFrustration('${domainId}', \`${frustration.replace(/`/g, '\`')}\`)">
                        <label class="hs-radio-label" for="frustration-${domainId}-${idx}">${frustration}</label>
                    </div>
                `).join('')}
            </div>

            <div class="hs-section-header">5) Which feels closest right now?</div>
            <div class="hs-radio-group">
                ${[
                    "I want to explore this more.",
                    "Parts of this are interesting, but I'm unsure.",
                    "I don't think this is for me.",
                    "I'm still figuring it out."
                ].map((reflection, idx) => `
                    <div class="hs-radio-option">
                        <input type="radio" class="hs-radio" name="reflect-${domainId}" id="reflect-${domainId}-${idx}" 
                            ${answer.reflect === reflection ? 'checked' : ''}
                            onchange="setReflection('${domainId}', \`${reflection.replace(/`/g, '\`')}\`)">
                        <label class="hs-radio-label" for="reflect-${domainId}-${idx}">${reflection}</label>
                    </div>
                `).join('')}
            </div>

            <div class="hs-btn-container">
                <button 
                    class="hs-btn hs-btn-secondary hs-btn-half" 
                    onclick="previousPass2()">
                    ← Back
                </button>
                <button 
                    class="hs-btn hs-btn-primary hs-btn-half" 
                    onclick="nextPass2()"
                    ${!isComplete ? 'disabled' : ''}>
                    ${state.pass2.index === state.pass2.order.length - 1 ? 'Finish' : 'Next →'}
                </button>
            </div>

            <div class="hs-helper-text">
                Tip: It's okay to be unsure. Exploring helps you learn what you like.
            </div>
        </div>
    `;
}

function renderClusters() {
    const clusterList = state.surfacedClusters.map(id => clusters.find(c => c.id === id)).filter(Boolean);
    
    // Find canonical pairs within surfaced clusters
    const suggestedPairs = canonicalPairs
        .filter(([a, b]) => state.surfacedClusters.includes(a) && state.surfacedClusters.includes(b))
        .slice(0, 2);

    return `
        <div class="hs-title">
            <h1>Where Your Interests Often Show Up</h1>
            <p>These aren't recommendations — just areas students often explore based on similar preferences.</p>
        </div>

        <div class="hs-card">
            <div style="display: grid; gap: 0.75rem;">
                ${clusterList.map(cluster => `
                    <div class="hs-cluster-card" onclick="exploreCluster('${cluster.id}')">
                        <div class="hs-cluster-title">${cluster.title}</div>
                        <div class="hs-cluster-desc">${cluster.about}</div>
                        <div class="hs-cluster-hint">Tap to explore</div>
                    </div>
                `).join('')}
            </div>

            ${suggestedPairs.length > 0 ? `
                <div class="hs-separator"></div>
                <div class="hs-section-header">Students also compare</div>
                <div style="font-size: 0.875rem; color: #475569; margin-bottom: 0.75rem;">
                    These areas can feel similar — comparing helps clarify:
                </div>
                <div class="hs-options">
                    ${suggestedPairs.map(([a, b]) => {
                        const clusterA = clusters.find(c => c.id === a);
                        const clusterB = clusters.find(c => c.id === b);
                        return `
                            <button class="hs-option-btn" onclick="openComparison('${a}', '${b}')">
                                ${clusterA.title} vs ${clusterB.title}
                            </button>
                        `;
                    }).join('')}
                </div>
            ` : ''}

            <div class="hs-separator"></div>
            <button class="hs-btn hs-btn-secondary" onclick="openComparePicker()">
                Compare any two areas
            </button>

            <div class="hs-helper-text">
                Your interests can change — and that's okay. This is about exploration, not deciding.
            </div>
        </div>
    `;
}

function renderExploreCluster() {
    const cluster = clusters.find(c => c.id === state.activeCluster);
    if (!cluster) return '<div>Cluster not found</div>';

    const majorsToShow = state.showAllMajors ? cluster.majors : cluster.majors.slice(0, 5);

    return `
        <div class="hs-title">
            <h1>${cluster.title}</h1>
            <p>This is context to help you explore — not a decision.</p>
        </div>

        <div class="hs-card">
            <div class="hs-info-note">
                This is context to help you explore — not a decision.
            </div>

            <div style="font-size: 0.875rem; color: #334155; line-height: 1.5rem;">
                ${cluster.about}
            </div>

            <div class="hs-separator"></div>

            <div class="hs-section-header">What students often work on</div>
            <ul class="hs-list">
                ${cluster.workOn.map(item => `<li>${item}</li>`).join('')}
            </ul>

            <div class="hs-section-header">What learning often feels like</div>
            <ul class="hs-list">
                ${cluster.learningFeels.map(item => `<li>${item}</li>`).join('')}
            </ul>

            <div class="hs-separator"></div>

            <div class="hs-section-header">Example majors students explore</div>
            <div style="font-size: 0.875rem; color: #475569; margin-bottom: 0.5rem;">
                Click a major to learn more and see schools
            </div>
            <div class="hs-options">
                ${majorsToShow.map(major => `
                    <button class="hs-option-btn" onclick="exploreMajor('${major}')">
                        ${major}
                    </button>
                `).join('')}
            </div>

            ${cluster.majors.length > 5 ? `
                <button class="hs-btn hs-btn-ghost" style="margin-top: 0.5rem;" onclick="toggleShowMore()">
                    ${state.showAllMajors ? 'Show fewer' : 'See more examples'}
                </button>
            ` : ''}

            <div class="hs-separator"></div>

            <button class="hs-btn hs-btn-secondary" onclick="openCompareFromCluster()">
                Compare this with another area
            </button>

            <div class="hs-btn-container" style="margin-top: 0.5rem;">
                <button class="hs-btn hs-btn-ghost" onclick="backToClusters()">
                    ← Back to clusters
                </button>
            </div>

            <div class="hs-helper-text">
                Liking something is a reason to explore it — not proof you need to be good at it yet.
            </div>
        </div>
    `;
}

function renderMajorDetail() {
    if (!state.activeMajor) return '<div>Major not found</div>';
    
    const cluster = clusters.find(c => c.id === state.activeMajor.clusterId);
    const majorName = state.activeMajor.name;
    
    // Get major info from catalog or generate it
    const majorInfo = majorCatalog[majorName] || generateMajorInfo(majorName, state.activeMajor.clusterId);

    return `
        <div class="hs-title">
            <h1>${majorInfo.title}</h1>
            <p>A quick, student-friendly overview to help you explore.</p>
        </div>

        <div class="hs-card">
            <div class="hs-prompt">
                ${majorInfo.whatItIs}
            </div>

            <div class="hs-separator"></div>

            <div class="hs-section-header">What you'll usually study</div>
            <ul class="hs-list">
                ${majorInfo.whatYouStudy.map(item => `<li>${item}</li>`).join('')}
            </ul>

            <div class="hs-section-header">What projects can feel like</div>
            <ul class="hs-list">
                ${majorInfo.whatProjectsFeelLike.map(item => `<li>${item}</li>`).join('')}
            </ul>

            <div class="hs-section-header">Good to know</div>
            <ul class="hs-list">
                ${majorInfo.goodToKnow.map(item => `<li>${item}</li>`).join('')}
            </ul>

            <div class="hs-section-header">Examples of career directions</div>
            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 0.5rem;">
                These are examples — not guarantees. People take many different paths.
            </div>
            <ul class="hs-list">
                ${majorInfo.careerExamples.map(item => `<li>${item}</li>`).join('')}
            </ul>

            <div class="hs-section-header">Try it while you're in high school</div>
            <ul class="hs-list">
                ${majorInfo.tryItInHS.map(item => `<li>${item}</li>`).join('')}
            </ul>

            <button class="hs-btn hs-btn-primary" style="margin-top: 1rem;" onclick="exploreSchools()">
                Explore schools by region
            </button>

            <button class="hs-btn hs-btn-ghost" style="margin-top: 0.5rem;" onclick="backToCluster()">
                ← Back
            </button>
        </div>
    `;
}

function renderSchools() {
    if (!state.activeMajor) return '<div>Major not found</div>';
    
    const cluster = clusters.find(c => c.id === state.activeMajor.clusterId);
    const regions = ['West', 'Midwest', 'Northeast', 'South'];

    if (!state.schoolsData.region) {
        return `
            <div class="hs-title">
                <h1>Schools to Explore</h1>
                <p>Examples of programs for ${state.activeMajor.name} (not rankings)</p>
            </div>

            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 0.75rem;">
                ${state.activeMajor.name} is commonly explored within ${cluster.title}.
            </div>

            <div class="hs-card">
                <div class="hs-section-header">Choose a region</div>
                <div class="hs-options">
                    ${regions.map(region => `
                        <button class="hs-region-btn" onclick="selectRegion('${region}')">
                            ${region}
                        </button>
                    `).join('')}
                </div>

                <button class="hs-btn hs-btn-ghost" style="margin-top: 1rem;" onclick="backToMajor()">
                    ← Back
                </button>
            </div>
        `;
    }

    return `
        <div class="hs-title">
            <h1>Schools in ${state.schoolsData.region}</h1>
            <p>${state.activeMajor.name} programs (via U.S. Dept of Education)</p>
        </div>

        <div class="hs-card">
            ${state.schoolsData.loading ? `
                <div class="hs-loading">Loading schools from College Scorecard...</div>
            ` : `
                ${state.schoolsData.schools.length === 0 ? `
                    <div style="font-size: 0.875rem; color: #475569;">
                        No schools found. Try a different region.
                    </div>
                ` : `
                    <div style="display: grid; gap: 0.5rem;">
                        ${state.schoolsData.schools.map(school => `
                            <div class="hs-school-item">
                                <div class="hs-school-name">${school.name}</div>
                                ${school.location ? `<div style="font-size: 0.75rem; color: #64748b;">${school.location}</div>` : ''}
                                <div class="hs-school-note">${school.note}</div>
                                ${school.url ? `<a href="https://${school.url}" target="_blank" style="font-size: 0.75rem; color: #008208;">Visit website →</a>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `}
            `}

            <button class="hs-btn hs-btn-secondary" style="margin-top: 1rem;" onclick="changeRegion()">
                Change region
            </button>

            <button class="hs-btn hs-btn-ghost" style="margin-top: 0.5rem;" onclick="backToMajor()">
                ← Back to major
            </button>
        </div>
    `;
}

function renderComparePicker() {
    const surfaced = state.surfacedClusters.map(id => clusters.find(c => c.id === id)).filter(Boolean);
    const allOthers = clusters.filter(c => !state.surfacedClusters.includes(c.id));
    
    const selected = state.comparePair || [null, null];

    return `
        <div class="hs-title">
            <h1>Compare Two Areas</h1>
            <p>Choose two areas to compare side by side</p>
        </div>

        <div class="hs-card">
            <div class="hs-section-header">Select first area</div>
            <div class="hs-options">
                ${surfaced.map(cluster => `
                    <button class="hs-option-btn ${selected[0] === cluster.id ? 'selected' : ''}" 
                        onclick="setCompareFirst('${cluster.id}')">
                        ${cluster.title}
                    </button>
                `).join('')}
            </div>

            ${surfaced.length > 0 && allOthers.length > 0 ? '<div class="hs-separator"></div>' : ''}

            ${allOthers.length > 0 ? `
                <details>
                    <summary>See all other areas</summary>
                    <div class="hs-options" style="margin-top: 0.75rem;">
                        ${allOthers.map(cluster => `
                            <button class="hs-option-btn ${selected[0] === cluster.id ? 'selected' : ''}" 
                                onclick="setCompareFirst('${cluster.id}')">
                                ${cluster.title}
                            </button>
                        `).join('')}
                    </div>
                </details>
            ` : ''}

            ${selected[0] ? `
                <div class="hs-separator"></div>
                <div class="hs-section-header">Select second area</div>
                <div class="hs-options">
                    ${clusters.filter(c => c.id !== selected[0]).map(cluster => `
                        <button class="hs-option-btn ${selected[1] === cluster.id ? 'selected' : ''}" 
                            onclick="setCompareSecond('${cluster.id}')">
                            ${cluster.title}
                        </button>
                    `).join('')}
                </div>
            ` : ''}

            <button class="hs-btn hs-btn-primary" style="margin-top: 1rem;"
                onclick="viewComparison()"
                ${!selected[0] || !selected[1] ? 'disabled' : ''}>
                Compare areas
            </button>

            <button class="hs-btn hs-btn-ghost" style="margin-top: 0.5rem;" 
                onclick="backToClusters()">
                ← Back
            </button>
        </div>
    `;
}

function renderComparison() {
    if (!state.comparePair || state.comparePair.length !== 2) {
        return '<div>No comparison selected</div>';
    }

    const [id1, id2] = state.comparePair;
    const cluster1 = clusters.find(c => c.id === id1);
    const cluster2 = clusters.find(c => c.id === id2);

    return `
        <div class="hs-title">
            <h1>Comparison View</h1>
            <p>${cluster1.title} vs ${cluster2.title}</p>
        </div>

        <div class="hs-card">
            <div class="hs-comparison-grid">
                <div class="hs-comparison-card">
                    <div class="hs-comparison-header">${cluster1.title}</div>
                    <div style="font-size: 0.875rem; color: #334155; line-height: 1.5rem;">
                        ${cluster1.about}
                    </div>
                    <div class="hs-section-header">What students enjoy</div>
                    <div style="font-size: 0.875rem; color: #334155;">
                        ${cluster1.enjoy}
                    </div>
                    <div class="hs-section-header">What you often work on</div>
                    <ul class="hs-list">
                        ${cluster1.workOn.slice(0, 3).map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>

                <div class="hs-comparison-card">
                    <div class="hs-comparison-header">${cluster2.title}</div>
                    <div style="font-size: 0.875rem; color: #334155; line-height: 1.5rem;">
                        ${cluster2.about}
                    </div>
                    <div class="hs-section-header">What students enjoy</div>
                    <div style="font-size: 0.875rem; color: #334155;">
                        ${cluster2.enjoy}
                    </div>
                    <div class="hs-section-header">What you often work on</div>
                    <ul class="hs-list">
                        ${cluster2.workOn.slice(0, 3).map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>
            </div>

            <div class="hs-btn-container" style="margin-top: 1rem;">
                <button class="hs-btn hs-btn-secondary hs-btn-half" 
                    onclick="exploreCluster('${id1}')">
                    Explore ${cluster1.title}
                </button>
                <button class="hs-btn hs-btn-secondary hs-btn-half" 
                    onclick="exploreCluster('${id2}')">
                    Explore ${cluster2.title}
                </button>
            </div>

            <button class="hs-btn hs-btn-ghost" style="margin-top: 0.5rem;" 
                onclick="backToClusters()">
                ← Back to clusters
            </button>
        </div>
    `;
}

// ========================================
// EVENT HANDLERS
// ========================================

function restartAssessment() {
    if (confirm('Are you sure you want to restart? All progress will be lost.')) {
        state.screen = 'welcome';
        state.pass1 = { index: 0, answers: {} };
        state.selectedDomains = new Set();
        state.pass2 = { order: [], index: 0, answers: {} };
        state.surfacedClusters = [];
        state.lastClusterId = null;
        state.activeCluster = null;
        state.activeMajor = null;
        state.showAllMajors = false;
        state.comparePair = null;
        state.schoolsData = { region: null, loading: false, schools: [] };
        render();
    }
}

function startPass1() {
    state.screen = 'pass1';
    render();
}

function setPass1Answer(domainId, value) {
    state.pass1.answers[domainId] = value;
    render();
}

function previousPass1() {
    if (state.pass1.index > 0) {
        state.pass1.index--;
        render();
    }
}

function nextPass1() {
    if (state.pass1.index < domains.length - 1) {
        state.pass1.index++;
        render();
    } else {
        state.screen = 'pass1_results';
        const preselected = new Set();
        domains.forEach(d => {
            if (state.pass1.answers[d.id] >= 2) {
                preselected.add(d.id);
            }
        });
        state.selectedDomains = preselected;
        render();
    }
}

function toggleDomain(domainId) {
    if (state.selectedDomains.has(domainId)) {
        state.selectedDomains.delete(domainId);
    } else {
        if (state.selectedDomains.size < 4) {
            state.selectedDomains.add(domainId);
        }
    }
    render();
}

function continueToPass2() {
    state.pass2.order = Array.from(state.selectedDomains);
    state.pass2.index = 0;
    state.screen = 'pass2';
    render();
}

function toggleActivity(domainId, activity) {
    if (!state.pass2.answers[domainId]) {
        state.pass2.answers[domainId] = { activities: [], style: null, motivations: [], frustration: null, reflect: null };
    }
    const activities = state.pass2.answers[domainId].activities;
    const index = activities.indexOf(activity);
    if (index > -1) {
        activities.splice(index, 1);
    } else {
        activities.push(activity);
    }
    render();
}

function setStyle(domainId, style) {
    if (!state.pass2.answers[domainId]) {
        state.pass2.answers[domainId] = { activities: [], style: null, motivations: [], frustration: null, reflect: null };
    }
    state.pass2.answers[domainId].style = style;
    render();
}

function toggleMotivation(domainId, motivation) {
    if (!state.pass2.answers[domainId]) {
        state.pass2.answers[domainId] = { activities: [], style: null, motivations: [], frustration: null, reflect: null };
    }
    const motivations = state.pass2.answers[domainId].motivations;
    const index = motivations.indexOf(motivation);
    if (index > -1) {
        motivations.splice(index, 1);
    } else {
        if (motivations.length < 2) {
            motivations.push(motivation);
        }
    }
    render();
}

function setFrustration(domainId, frustration) {
    if (!state.pass2.answers[domainId]) {
        state.pass2.answers[domainId] = { activities: [], style: null, motivations: [], frustration: null, reflect: null };
    }
    state.pass2.answers[domainId].frustration = frustration;
    render();
}

function setReflection(domainId, reflection) {
    if (!state.pass2.answers[domainId]) {
        state.pass2.answers[domainId] = { activities: [], style: null, motivations: [], frustration: null, reflect: null };
    }
    state.pass2.answers[domainId].reflect = reflection;
    render();
}

function previousPass2() {
    if (state.pass2.index > 0) {
        state.pass2.index--;
        render();
    } else {
        state.screen = 'pass1_results';
        render();
    }
}

function nextPass2() {
    if (state.pass2.index < state.pass2.order.length - 1) {
        state.pass2.index++;
        render();
    } else {
        finishPass2();
    }
}

function finishPass2() {
    const surfaced = new Set();
    state.pass2.order.forEach(domainId => {
        const baseClusters = domainBaseClusters[domainId] || [];
        baseClusters.forEach(c => surfaced.add(c));
    });
    state.surfacedClusters = clusters.map(c => c.id).filter(id => surfaced.has(id));
    state.lastClusterId = state.surfacedClusters[0] || null;
    state.screen = 'clusters';
    render();
}

function exploreCluster(clusterId) {
    state.activeCluster = clusterId;
    state.lastClusterId = clusterId;
    state.showAllMajors = false;
    state.screen = 'explore_cluster';
    render();
}

function toggleShowMore() {
    state.showAllMajors = !state.showAllMajors;
    render();
}

function exploreMajor(majorName) {
    state.activeMajor = { name: majorName, clusterId: state.activeCluster };
    state.screen = 'major_detail';
    render();
}

function exploreSchools() {
    state.schoolsData.region = null;
    state.schoolsData.schools = [];
    state.screen = 'schools';
    render();
}

function selectRegion(region) {
    state.schoolsData.region = region;
    render();
    if (state.activeMajor) {
        fetchSchoolsByMajor(state.activeMajor.name, state.activeMajor.clusterId, region);
    }
}

function changeRegion() {
    state.schoolsData.region = null;
    state.schoolsData.schools = [];
    render();
}

function backToMajor() {
    state.schoolsData.region = null;
    state.schoolsData.schools = [];
    state.screen = 'major_detail';
    render();
}

function backToCluster() {
    state.screen = 'explore_cluster';
    render();
}

function backToClusters() {
    state.activeCluster = null;
    state.activeMajor = null;
    state.showAllMajors = false;
    state.screen = 'clusters';
    render();
}

function openComparePicker() {
    state.comparePair = [null, null];
    state.screen = 'compare_picker';
    render();
}

function openCompareFromCluster() {
    state.comparePair = [state.activeCluster, null];
    state.screen = 'compare_picker';
    render();
}

function openComparison(id1, id2) {
    state.comparePair = [id1, id2];
    state.screen = 'compare';
    render();
}

function setCompareFirst(clusterId) {
    state.comparePair = [clusterId, state.comparePair ? state.comparePair[1] : null];
    render();
}

function setCompareSecond(clusterId) {
    state.comparePair = [state.comparePair[0], clusterId];
    render();
}

function viewComparison() {
    if (state.comparePair && state.comparePair[0] && state.comparePair[1]) {
        state.screen = 'compare';
        render();
    }
}

// ========================================
// INITIALIZATION
// ========================================

document.addEventListener('DOMContentLoaded', function() {
    render();
});

    </script>
</body>
</html>
